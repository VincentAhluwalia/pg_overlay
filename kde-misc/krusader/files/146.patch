From aa3d23d1a5f3f8eec23c7eac18f741f8c5386bfe Mon Sep 17 00:00:00 2001
From: Alexander Bikadorov <alex.bikadorov@kdemail.net>
Date: Fri, 27 Sep 2024 14:27:20 +0200
Subject: [PATCH 01/11] Fix all "QKeyCombination operator+" compiler warnings

---
 app/KViewer/krviewer.cpp             |  4 ++--
 app/KViewer/lister.cpp               | 10 +++++-----
 app/Panel/listpanelactions.cpp       |  2 +-
 app/Panel/viewactions.cpp            | 16 ++++++++--------
 app/Synchronizer/synchronizergui.cpp | 18 +++++++++---------
 5 files changed, 25 insertions(+), 25 deletions(-)

diff --git a/app/KViewer/krviewer.cpp b/app/KViewer/krviewer.cpp
index bd21a5867..66f30dc02 100644
--- a/app/KViewer/krviewer.cpp
+++ b/app/KViewer/krviewer.cpp
@@ -128,7 +128,7 @@ KrViewer::KrViewer(QWidget *parent)
     detachAction->setText(i18n("&Detach Tab"));
     // no point in detaching only one tab..
     detachAction->setEnabled(false);
-    ac->setDefaultShortcut(detachAction, Qt::META + Qt::Key_D);
+    ac->setDefaultShortcut(detachAction, Qt::META | Qt::Key_D);
     viewerMenu->addAction(detachAction);
 
     quitAction = ac->addAction(KStandardAction::Quit, this, SLOT(close()));
@@ -145,7 +145,7 @@ KrViewer::KrViewer(QWidget *parent)
     tabNextAction = ac->addAction("nextTab", this, SLOT(nextTab()));
     tabNextAction->setText(i18n("&Next Tab"));
     shortcuts = KStandardShortcut::tabNext();
-    shortcuts.append(Qt::CTRL + Qt::Key_Tab); // reenforce QTabWidget shortcut
+    shortcuts.append(Qt::CTRL | Qt::Key_Tab); // reenforce QTabWidget shortcut
     ac->setDefaultShortcuts(tabNextAction, shortcuts);
 
     tabPrevAction = ac->addAction("prevTab", this, SLOT(prevTab()));
diff --git a/app/KViewer/lister.cpp b/app/KViewer/lister.cpp
index 138c0e51d..b79652828 100644
--- a/app/KViewer/lister.cpp
+++ b/app/KViewer/lister.cpp
@@ -1210,12 +1210,12 @@ Lister::Lister(QWidget *parent)
     _actionPrint = new QAction(Icon("document-print"), i18n("Print..."), this);
     connect(_actionPrint, &QAction::triggered, this, &Lister::print);
     actionCollection()->addAction("print", _actionPrint);
-    actionCollection()->setDefaultShortcut(_actionPrint, Qt::CTRL + Qt::Key_P);
+    actionCollection()->setDefaultShortcut(_actionPrint, Qt::CTRL | Qt::Key_P);
 
     _actionSearch = new QAction(Icon("system-search"), i18n("Search"), this);
     connect(_actionSearch, &QAction::triggered, this, &Lister::searchAction);
     actionCollection()->addAction("search", _actionSearch);
-    actionCollection()->setDefaultShortcut(_actionSearch, Qt::CTRL + Qt::Key_F);
+    actionCollection()->setDefaultShortcut(_actionSearch, Qt::CTRL | Qt::Key_F);
 
     _actionSearchNext = new QAction(Icon("go-down"), i18n("Search next"), this);
     connect(_actionSearchNext, &QAction::triggered, this, &Lister::searchNext);
@@ -1225,17 +1225,17 @@ Lister::Lister(QWidget *parent)
     _actionSearchPrev = new QAction(Icon("go-up"), i18n("Search previous"), this);
     connect(_actionSearchPrev, &QAction::triggered, this, &Lister::searchPrev);
     actionCollection()->addAction("search_prev", _actionSearchPrev);
-    actionCollection()->setDefaultShortcut(_actionSearchPrev, Qt::SHIFT + Qt::Key_F3);
+    actionCollection()->setDefaultShortcut(_actionSearchPrev, Qt::SHIFT | Qt::Key_F3);
 
     _actionJumpToPosition = new QAction(Icon("go-jump"), i18n("Jump to position"), this);
     connect(_actionJumpToPosition, &QAction::triggered, this, &Lister::jumpToPosition);
     actionCollection()->addAction("jump_to_position", _actionJumpToPosition);
-    actionCollection()->setDefaultShortcut(_actionJumpToPosition, Qt::CTRL + Qt::Key_G);
+    actionCollection()->setDefaultShortcut(_actionJumpToPosition, Qt::CTRL | Qt::Key_G);
 
     _actionHexMode = new QAction(Icon("document-preview"), i18n("Hex mode"), this);
     connect(_actionHexMode, &QAction::triggered, this, &Lister::toggleHexMode);
     actionCollection()->addAction("hex_mode", _actionHexMode);
-    actionCollection()->setDefaultShortcut(_actionHexMode, Qt::CTRL + Qt::Key_H);
+    actionCollection()->setDefaultShortcut(_actionHexMode, Qt::CTRL | Qt::Key_H);
 
     new ListerEncodingMenu(this, i18n("Select charset"), "character-set", actionCollection());
 
diff --git a/app/Panel/listpanelactions.cpp b/app/Panel/listpanelactions.cpp
index e0cd5e258..421009478 100644
--- a/app/Panel/listpanelactions.cpp
+++ b/app/Panel/listpanelactions.cpp
@@ -85,7 +85,7 @@ ListPanelActions::ListPanelActions(QObject *parent, KrMainWindow *mainWindow)
     actMatchChecksum = action(i18n("Verify Checksum..."), "document-edit-decrypt-verify", 0, _func, SLOT(matchChecksum()), "match checksum");
     action(i18n("New Symlink..."), nullptr, Qt::CTRL | Qt::ALT | Qt::Key_S, _func, SLOT(krlink()), "new symlink");
     actTest = action(i18n("T&est Archive"), "archive-extract", Qt::ALT | Qt::SHIFT | Qt::Key_E, _func, SLOT(testArchive()), "test archives");
-    action(i18n("Alternative Delete"), "edit-delete", Qt::Key_Delete + Qt::CTRL, _func, SLOT(alternativeDeleteFiles()), "alternative delete");
+    action(i18n("Alternative Delete"), "edit-delete", Qt::Key_Delete | Qt::CTRL, _func, SLOT(alternativeDeleteFiles()), "alternative delete");
 
     // navigation
     actRoot = action(i18n("Root"), "folder-red", Qt::CTRL | Qt::Key_Backspace, _func, SLOT(root()), "root");
diff --git a/app/Panel/viewactions.cpp b/app/Panel/viewactions.cpp
index b80de8d0e..aad29e7bb 100644
--- a/app/Panel/viewactions.cpp
+++ b/app/Panel/viewactions.cpp
@@ -22,17 +22,17 @@ ViewActions::ViewActions(QObject *parent, KrMainWindow *mainWindow)
     actDefaultZoom = action(i18n("Default Zoom"), "zoom-original", 0, SLOT(defaultZoom()), "default_zoom");
 
     // filter
-    action(i18n("&All Files"), nullptr, Qt::SHIFT + Qt::Key_F10, SLOT(allFilter()), "all files");
-    // actExecFilter = new QAction( i18n( "&Executables" ), SHIFT + Qt::Key_F11,
+    action(i18n("&All Files"), nullptr, Qt::SHIFT | Qt::Key_F10, SLOT(allFilter()), "all files");
+    // actExecFilter = new QAction( i18n( "&Executables" ), SHIFT | Qt::Key_F11,
     //                              SLOTS, SLOT(execFilter()), actionCollection(), "exec files" );
-    action(i18n("&Custom"), nullptr, Qt::SHIFT + Qt::Key_F12, SLOT(customFilter()), "custom files");
+    action(i18n("&Custom"), nullptr, Qt::SHIFT | Qt::Key_F12, SLOT(customFilter()), "custom files");
 
     // selection
-    actSelect = action(i18n("Select &Group..."), "edit-select", Qt::CTRL + Qt::Key_Plus, SLOT(markGroup()), "select group");
-    actSelectAll = action(i18n("&Select All"), "edit-select-all", Qt::ALT + Qt::Key_Plus, SLOT(markAll()), "select all");
-    actUnselect = action(i18n("&Unselect Group..."), "kr_unselect", Qt::CTRL + Qt::Key_Minus, SLOT(unmarkGroup()), "unselect group");
-    actUnselectAll = action(i18n("U&nselect All"), "edit-select-none", Qt::ALT + Qt::Key_Minus, SLOT(unmarkAll()), "unselect all");
-    actInvert = action(i18n("&Invert Selection"), "edit-select-invert", Qt::ALT + Qt::Key_Asterisk, SLOT(invertSelection()), "invert");
+    actSelect = action(i18n("Select &Group..."), "edit-select", Qt::CTRL | Qt::Key_Plus, SLOT(markGroup()), "select group");
+    actSelectAll = action(i18n("&Select All"), "edit-select-all", Qt::ALT | Qt::Key_Plus, SLOT(markAll()), "select all");
+    actUnselect = action(i18n("&Unselect Group..."), "kr_unselect", Qt::CTRL | Qt::Key_Minus, SLOT(unmarkGroup()), "unselect group");
+    actUnselectAll = action(i18n("U&nselect All"), "edit-select-none", Qt::ALT | Qt::Key_Minus, SLOT(unmarkAll()), "unselect all");
+    actInvert = action(i18n("&Invert Selection"), "edit-select-invert", Qt::ALT | Qt::Key_Asterisk, SLOT(invertSelection()), "invert");
     actRestoreSelection = action(i18n("Restore Selection"), nullptr, 0, SLOT(restoreSelection()), "restore_selection");
     actMarkSameBaseName = action(i18n("Select Files with the Same Name"), nullptr, 0, SLOT(markSameBaseName()), "select_same_base_name");
     actMarkSameExtension = action(i18n("Select Files with the Same Extension"), nullptr, 0, SLOT(markSameExtension()), "select_same_extension");
diff --git a/app/Synchronizer/synchronizergui.cpp b/app/Synchronizer/synchronizergui.cpp
index 239f913e0..70a1c24e3 100644
--- a/app/Synchronizer/synchronizergui.cpp
+++ b/app/Synchronizer/synchronizergui.cpp
@@ -291,37 +291,37 @@ void SynchronizerGUI::initGUI(const QString &profileName, QUrl leftURL, QUrl rig
 
     checked = group.readEntry("LeftToRight Button", _BtnLeftToRight);
     description = i18n("Show files marked to <i>Copy from left to right</i>.");
-    btnLeftToRight = createButton(showOptions, "arrow-right", checked, Qt::CTRL + Qt::Key_L, description, ">");
+    btnLeftToRight = createButton(showOptions, "arrow-right", checked, Qt::CTRL | Qt::Key_L, description, ">");
     showOptionsLayout->addWidget(btnLeftToRight, 0, 0);
 
     checked = group.readEntry("Equals Button", _BtnEquals);
     description = i18n("Show files considered to be identical.");
-    btnEquals = createButton(showOptions, "equals", checked, Qt::CTRL + Qt::Key_E, description, "=");
+    btnEquals = createButton(showOptions, "equals", checked, Qt::CTRL | Qt::Key_E, description, "=");
     showOptionsLayout->addWidget(btnEquals, 0, 1);
 
     checked = group.readEntry("Differents Button", _BtnDifferents);
     description = i18n("Show excluded files.");
-    btnDifferents = createButton(showOptions, "unequals", checked, Qt::CTRL + Qt::Key_D, description, "!=");
+    btnDifferents = createButton(showOptions, "unequals", checked, Qt::CTRL | Qt::Key_D, description, "!=");
     showOptionsLayout->addWidget(btnDifferents, 0, 2);
 
     checked = group.readEntry("RightToLeft Button", _BtnRightToLeft);
     description = i18n("Show files marked to <i>Copy from right to left</i>.");
-    btnRightToLeft = createButton(showOptions, "arrow-left", checked, Qt::CTRL + Qt::Key_R, description, "<");
+    btnRightToLeft = createButton(showOptions, "arrow-left", checked, Qt::CTRL | Qt::Key_R, description, "<");
     showOptionsLayout->addWidget(btnRightToLeft, 0, 3);
 
     checked = group.readEntry("Deletable Button", _BtnDeletable);
     description = i18n("Show files marked to delete.");
-    btnDeletable = createButton(showOptions, "user-trash", checked, Qt::CTRL + Qt::Key_T, description);
+    btnDeletable = createButton(showOptions, "user-trash", checked, Qt::CTRL | Qt::Key_T, description);
     showOptionsLayout->addWidget(btnDeletable, 0, 4);
 
     checked = group.readEntry("Duplicates Button", _BtnDuplicates);
     description = i18n("Show files that exist on both sides.");
-    btnDuplicates = createButton(showOptions, "arrow-up", checked, Qt::CTRL + Qt::Key_I, description, i18n("Duplicates"), true);
+    btnDuplicates = createButton(showOptions, "arrow-up", checked, Qt::CTRL | Qt::Key_I, description, i18n("Duplicates"), true);
     showOptionsLayout->addWidget(btnDuplicates, 0, 5);
 
     checked = group.readEntry("Singles Button", _BtnSingles);
     description = i18n("Show files that exist on one side only.");
-    btnSingles = createButton(showOptions, "arrow-down", checked, Qt::CTRL + Qt::Key_N, description, i18n("Singles"), true);
+    btnSingles = createButton(showOptions, "arrow-down", checked, Qt::CTRL | Qt::Key_N, description, i18n("Singles"), true);
     showOptionsLayout->addWidget(btnSingles, 0, 6);
 
     grid->addWidget(optionWidget, 2, 0, 1, 3);
@@ -452,13 +452,13 @@ void SynchronizerGUI::initGUI(const QString &profileName, QUrl leftURL, QUrl rig
     buttons->setContentsMargins(0, 0, 0, 0);
 
     profileManager = new ProfileManager("SynchronizerProfile", this);
-    profileManager->setShortcut(Qt::CTRL + Qt::Key_P);
+    profileManager->setShortcut(Qt::CTRL | Qt::Key_P);
     profileManager->setWhatsThis(i18n("Profile manager (Ctrl+P)."));
     buttons->addWidget(profileManager);
 
     btnSwapSides = new QPushButton(this);
     btnSwapSides->setIcon(Icon("document-swap"));
-    btnSwapSides->setShortcut(Qt::CTRL + Qt::Key_S);
+    btnSwapSides->setShortcut(Qt::CTRL | Qt::Key_S);
     btnSwapSides->setWhatsThis(i18n("Swap sides (Ctrl+S)."));
     buttons->addWidget(btnSwapSides);
 
-- 
GitLab


From 08ceda44c878dcb58f1cb893e73b28b22619a1af Mon Sep 17 00:00:00 2001
From: Alexander Bikadorov <alex.bikadorov@kdemail.net>
Date: Fri, 27 Sep 2024 15:11:29 +0200
Subject: [PATCH 02/11] Fix all "pos() is deprecated" compiler warnings

---
 app/DiskUsage/dufilelight.cpp            | 2 +-
 app/DiskUsage/dulines.cpp                | 2 +-
 app/DiskUsage/dulistview.cpp             | 2 +-
 app/DiskUsage/radialMap/widgetEvents.cpp | 7 ++++---
 app/GUI/mediabutton.cpp                  | 2 +-
 app/Panel/PanelView/krmousehandler.cpp   | 2 +-
 app/Panel/krfiletreeview.cpp             | 2 +-
 app/Panel/listpanel.cpp                  | 2 +-
 app/krusaderview.cpp                     | 4 ++--
 app/paneltabbar.cpp                      | 6 +++---
 10 files changed, 16 insertions(+), 15 deletions(-)

diff --git a/app/DiskUsage/dufilelight.cpp b/app/DiskUsage/dufilelight.cpp
index 3fc5f52d0..00754b113 100644
--- a/app/DiskUsage/dufilelight.cpp
+++ b/app/DiskUsage/dufilelight.cpp
@@ -105,7 +105,7 @@ void DUFilelight::mousePressEvent(QMouseEvent *event)
 
         filelightPopup.addAction(i18n("Minimum font size"), this, SLOT(minFontSize()));
 
-        diskUsage->rightClickMenu(event->globalPos(), file, &filelightPopup, i18n("Filelight"));
+        diskUsage->rightClickMenu(event->globalPosition().toPoint(), file, &filelightPopup, i18n("Filelight"));
         return;
     } else if (event->button() == Qt::LeftButton) {
         const RadialMap::Segment *focus = focusSegment();
diff --git a/app/DiskUsage/dulines.cpp b/app/DiskUsage/dulines.cpp
index 947f8ecee..de36c3233 100644
--- a/app/DiskUsage/dulines.cpp
+++ b/app/DiskUsage/dulines.cpp
@@ -411,7 +411,7 @@ bool DULines::doubleClicked(QTreeWidgetItem *item)
 void DULines::mouseDoubleClickEvent(QMouseEvent *e)
 {
     if (e || e->button() == Qt::LeftButton) {
-        QPoint vp = viewport()->mapFromGlobal(e->globalPos());
+        QPoint vp = viewport()->mapFromGlobal(e->globalPosition().toPoint());
         QTreeWidgetItem *item = itemAt(vp);
 
         if (doubleClicked(item))
diff --git a/app/DiskUsage/dulistview.cpp b/app/DiskUsage/dulistview.cpp
index e8f70bf2d..d1f0e24cd 100644
--- a/app/DiskUsage/dulistview.cpp
+++ b/app/DiskUsage/dulistview.cpp
@@ -235,7 +235,7 @@ bool DUListView::doubleClicked(QTreeWidgetItem *item)
 void DUListView::mouseDoubleClickEvent(QMouseEvent *e)
 {
     if (e || e->button() == Qt::LeftButton) {
-        QPoint vp = viewport()->mapFromGlobal(e->globalPos());
+        QPoint vp = viewport()->mapFromGlobal(e->globalPosition().toPoint());
         QTreeWidgetItem *item = itemAt(vp);
 
         if (doubleClicked(item))
diff --git a/app/DiskUsage/radialMap/widgetEvents.cpp b/app/DiskUsage/radialMap/widgetEvents.cpp
index cd84e70be..71bb812ce 100644
--- a/app/DiskUsage/radialMap/widgetEvents.cpp
+++ b/app/DiskUsage/radialMap/widgetEvents.cpp
@@ -137,7 +137,7 @@ void RadialMap::Widget::mouseMoveEvent(QMouseEvent *e)
         }
 
         // updates tooltip pseudo-transparent background
-        m_tip.moveto(e->globalPos(), *this, (p.y() < 0));
+        m_tip.moveto(e->globalPosition().toPoint(), *this, (p.y() < 0));
     } else if (oldFocus && oldFocus->file() != m_tree) {
         unsetCursor();
         m_tip.hide();
@@ -177,7 +177,7 @@ void RadialMap::Widget::mousePressEvent(QMouseEvent *e)
             popup.addSeparator();
             actEditDel = popup.addAction(Icon("edit-delete"), i18n("&Delete"));
 
-            QAction *result = popup.exec(e->globalPos());
+            QAction *result = popup.exec(e->globalPosition().toPoint());
             if (result == nullptr)
                 result = (QAction *)-1; // sanity
 
@@ -220,7 +220,8 @@ void RadialMap::Widget::mousePressEvent(QMouseEvent *e)
         } else {
         sectionTwo:
 
-            const QRect rect(e->x() - 20, e->y() - 20, 40, 40);
+            const QPoint pos = e->position().toPoint();
+            const QRect rect(pos.x() - 20, pos.y() - 20, 40, 40);
 
             m_tip.hide(); // user expects this
 
diff --git a/app/GUI/mediabutton.cpp b/app/GUI/mediabutton.cpp
index 4500df881..8fc046408 100644
--- a/app/GUI/mediabutton.cpp
+++ b/app/GUI/mediabutton.cpp
@@ -299,7 +299,7 @@ bool MediaButton::eventFilter(QObject *o, QEvent *e)
                     if (act && act->data().canConvert<QString>()) {
                         QString id = act->data().toString();
                         if (!id.isEmpty())
-                            rightClickMenu(id, m->globalPos());
+                            rightClickMenu(id, m->globalPosition().toPoint());
                     }
                 }
                 m->accept();
diff --git a/app/Panel/PanelView/krmousehandler.cpp b/app/Panel/PanelView/krmousehandler.cpp
index 26db11ea4..6572066e3 100644
--- a/app/Panel/PanelView/krmousehandler.cpp
+++ b/app/Panel/PanelView/krmousehandler.cpp
@@ -132,7 +132,7 @@ bool KrMouseHandler::mousePressEvent(QMouseEvent *e)
                 }
                 _view->setCurrentKrViewItem(item);
             }
-            handleContextMenu(item, e->globalPos());
+            handleContextMenu(item, e->globalPosition().toPoint());
             e->accept();
             return true;
         } else if (e->modifiers() == Qt::ControlModifier) {
diff --git a/app/Panel/krfiletreeview.cpp b/app/Panel/krfiletreeview.cpp
index faa9244f3..711b242b2 100644
--- a/app/Panel/krfiletreeview.cpp
+++ b/app/Panel/krfiletreeview.cpp
@@ -155,7 +155,7 @@ void KrFileTreeView::slotActivated(const QModelIndex &index)
 
 void KrFileTreeView::dropEvent(QDropEvent *event)
 {
-    QUrl destination = urlForProxyIndex(indexAt(event->pos()));
+    QUrl destination = urlForProxyIndex(indexAt(event->position().toPoint()));
     if (destination.isEmpty()) {
         return;
     }
diff --git a/app/Panel/listpanel.cpp b/app/Panel/listpanel.cpp
index f72d07093..a3151431f 100644
--- a/app/Panel/listpanel.cpp
+++ b/app/Panel/listpanel.cpp
@@ -850,7 +850,7 @@ void ListPanel::handleDrop(QDropEvent *event, bool onView)
     // find dropping destination
     QString destinationDir = "";
     const bool dragFromThisPanel = event->source() == this;
-    const KrViewItem *item = onView ? view->getKrViewItemAt(event->pos()) : nullptr;
+    const KrViewItem *item = onView ? view->getKrViewItemAt(event->position().toPoint()) : nullptr;
     if (item) {
         const FileItem *file = item->getFileItem();
         if (file && !file->isDir() && dragFromThisPanel) {
diff --git a/app/krusaderview.cpp b/app/krusaderview.cpp
index 6f0893144..559d8c811 100644
--- a/app/krusaderview.cpp
+++ b/app/krusaderview.cpp
@@ -516,7 +516,7 @@ void KrusaderView::draggingTab(PanelManager *from, QMouseEvent *e)
 
     QCursor cursor(Icon(icon).pixmap(22));
 
-    if (cursorIsOnOtherSide(from, e->globalPos())) {
+    if (cursorIsOnOtherSide(from, e->globalPosition().toPoint())) {
         if (!qApp->overrideCursor())
             qApp->setOverrideCursor(cursor);
     } else
@@ -527,6 +527,6 @@ void KrusaderView::draggingTabFinished(PanelManager *from, QMouseEvent *e)
 {
     qApp->restoreOverrideCursor();
 
-    if (cursorIsOnOtherSide(from, e->globalPos()))
+    if (cursorIsOnOtherSide(from, e->globalPosition().toPoint()))
         from->moveTabToOtherSide();
 }
diff --git a/app/paneltabbar.cpp b/app/paneltabbar.cpp
index 82941b0c8..88e776217 100644
--- a/app/paneltabbar.cpp
+++ b/app/paneltabbar.cpp
@@ -286,7 +286,7 @@ void PanelTabBar::mousePressEvent(QMouseEvent *e)
             setCurrentIndex(clickedTabIndex);
 
         // show the popup menu
-        _panelActionMenu->menu()->popup(e->globalPos());
+        _panelActionMenu->menu()->popup(e->globalPosition().toPoint());
     } else if (e->button() == Qt::LeftButton && !_tabDoubleClicked) {
         bool isDuplicationEvent = false;
 
@@ -360,7 +360,7 @@ void PanelTabBar::mouseReleaseEvent(QMouseEvent *e)
 void PanelTabBar::dragEnterEvent(QDragEnterEvent *e)
 {
     e->accept();
-    handleDragEvent(tabAt(e->pos()));
+    handleDragEvent(tabAt(e->position().toPoint()));
     QTabBar::dragEnterEvent(e);
 }
 
@@ -372,7 +372,7 @@ void PanelTabBar::dragLeaveEvent(QDragLeaveEvent *)
 void PanelTabBar::dragMoveEvent(QDragMoveEvent *e)
 {
     e->ignore();
-    handleDragEvent(tabAt(e->pos()));
+    handleDragEvent(tabAt(e->position().toPoint()));
     QTabBar::dragMoveEvent(e);
 }
 
-- 
GitLab


From 39c8d9aae3cd5b6567a673d1b8d2a0bd02b324e8 Mon Sep 17 00:00:00 2001
From: Alexander Bikadorov <alex.bikadorov@kdemail.net>
Date: Fri, 27 Sep 2024 16:06:25 +0200
Subject: [PATCH 03/11] Fix all compiler warnings for missing "noexcept" in
 lambda definition

---
 app/Archive/kr7zencryptionchecker.cpp | 2 +-
 app/MountMan/kmountmangui.cpp         | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/Archive/kr7zencryptionchecker.cpp b/app/Archive/kr7zencryptionchecker.cpp
index b5f8793c8..091fafa4a 100644
--- a/app/Archive/kr7zencryptionchecker.cpp
+++ b/app/Archive/kr7zencryptionchecker.cpp
@@ -13,7 +13,7 @@ Kr7zEncryptionChecker::Kr7zEncryptionChecker()
     , lastData()
 {
     setOutputChannelMode(KProcess::SeparateChannels); // without this output redirection has no effect!
-    this->setChildProcessModifier([] {
+    this->setChildProcessModifier([]() noexcept {
         // This function is called after the fork but for the exec. We create a process group
         // to work around a broken wrapper script of 7z. Without this only the wrapper is killed.
         setsid(); // make this process leader of a new process group
diff --git a/app/MountMan/kmountmangui.cpp b/app/MountMan/kmountmangui.cpp
index 8ba314006..cc0141b0b 100644
--- a/app/MountMan/kmountmangui.cpp
+++ b/app/MountMan/kmountmangui.cpp
@@ -291,7 +291,7 @@ void KMountManGUI::addNonMounted()
 
 void KMountManGUI::addItemToMountList(KrTreeWidget *lst, fsData &fs, const QList<Solid::Device> &blockDevices) const
 {
-    const std::function deviceGetter = [blockDevices]() {
+    const std::function deviceGetter = [blockDevices]() noexcept {
         return blockDevices;
     };
     const auto udi = KMountMan::findUdiForPath(fs.mntPoint(), Solid::DeviceInterface::StorageAccess, deviceGetter);
-- 
GitLab


From c4f0aa66bf3d3636b0b0df9c41633b2456527f15 Mon Sep 17 00:00:00 2001
From: Alexander Bikadorov <alex.bikadorov@kdemail.net>
Date: Fri, 27 Sep 2024 16:08:23 +0200
Subject: [PATCH 04/11] Fix all compiler warnings for deprecated usages of
 QWidget::associatedWidgets()

---
 app/BookMan/krbookmarkhandler.cpp | 12 ++++++------
 app/UserAction/kraction.cpp       |  6 +++---
 2 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/app/BookMan/krbookmarkhandler.cpp b/app/BookMan/krbookmarkhandler.cpp
index 1282a3148..393e3a984 100644
--- a/app/BookMan/krbookmarkhandler.cpp
+++ b/app/BookMan/krbookmarkhandler.cpp
@@ -124,9 +124,9 @@ void KrBookmarkHandler::deleteBookmark(KrBookmark *bm)
         clearBookmarks(bm); // remove the child bookmarks
     removeReferences(_root, bm);
 
-    const auto widgets = bm->associatedWidgets(); 
-    for (QWidget *w : widgets)
-        w->removeAction(bm);
+    const auto widgets = bm->associatedObjects();
+    for (QObject *w : widgets)
+        qobject_cast<QWidget *>(w)->removeAction(bm);
     delete bm;
 
     exportToFile();
@@ -555,9 +555,9 @@ void KrBookmarkHandler::clearBookmarks(KrBookmark *root, bool removeBookmarks)
         } else if (bm->isSeparator()) {
             delete bm;
         } else if (removeBookmarks) {
-	    const auto widgets = bm->associatedWidgets(); 
-            for (QWidget *w : widgets) {
-                w->removeAction(bm);
+            const auto widgets = bm->associatedObjects();
+            for (QObject *w : widgets) {
+                qobject_cast<QWidget *>(w)->removeAction(bm);
             }
             delete bm;
         }
diff --git a/app/UserAction/kraction.cpp b/app/UserAction/kraction.cpp
index 2f568f72a..ecacb7518 100644
--- a/app/UserAction/kraction.cpp
+++ b/app/UserAction/kraction.cpp
@@ -356,9 +356,9 @@ KrAction::KrAction(KActionCollection *parent, const QString &name)
 
 KrAction::~KrAction()
 {
-    const auto widgets = associatedWidgets();
-    for (QWidget *w : widgets)
-        w->removeAction(this);
+    const auto widgets = associatedObjects();
+    for (QObject *w : widgets)
+        qobject_cast<QWidget *>(w)->removeAction(this);
     krUserAction->removeKrAction(this); // Importent! Else Krusader will crash when writing the actions to file
 }
 
-- 
GitLab


From bd69bb79d1779db9ba9b2868eb565473e0e1e7e7 Mon Sep 17 00:00:00 2001
From: Alexander Bikadorov <alex.bikadorov@kdemail.net>
Date: Fri, 27 Sep 2024 16:09:04 +0200
Subject: [PATCH 05/11] Fix all compiler warnings for unused parameter

---
 app/FileSystem/virtualfilesystem.cpp | 2 +-
 app/Splitter/splittergui.cpp         | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/FileSystem/virtualfilesystem.cpp b/app/FileSystem/virtualfilesystem.cpp
index 731080ca1..738f0ec2f 100644
--- a/app/FileSystem/virtualfilesystem.cpp
+++ b/app/FileSystem/virtualfilesystem.cpp
@@ -72,7 +72,7 @@ void VirtualFileSystem::copyFiles(const QList<QUrl> &urls,
     emit fileSystemChanged(QUrl("virt:///" + dir), false); // may call refresh()
 }
 
-void VirtualFileSystem::dropFiles(const QUrl &destination, QDropEvent *event, QWidget *targetWidget)
+void VirtualFileSystem::dropFiles(const QUrl &destination, QDropEvent *event, QWidget *)
 {
     const QList<QUrl> &urls = KUrlMimeData::urlsFromMimeData(event->mimeData());
     // dropping on virtual filesystem is always copy operation
diff --git a/app/Splitter/splittergui.cpp b/app/Splitter/splittergui.cpp
index 705468682..724c80d52 100644
--- a/app/Splitter/splittergui.cpp
+++ b/app/Splitter/splittergui.cpp
@@ -43,7 +43,7 @@ struct SplitterGUI::PredefinedDevice {
         , capacity(other.capacity)
     {
     }
-    PredefinedDevice &operator=(const PredefinedDevice &other)
+    PredefinedDevice &operator=(const PredefinedDevice &)
     {
         return *this;
     }
-- 
GitLab


From e375f3b658278b2211e39fb50d60314a666b69ef Mon Sep 17 00:00:00 2001
From: Alexander Bikadorov <alex.bikadorov@kdemail.net>
Date: Fri, 27 Sep 2024 16:10:50 +0200
Subject: [PATCH 06/11] Fix all compiler warnings for deprecated usage of
 QAbstractItemView::itemDelegate()

---
 app/Panel/PanelView/krinterbriefview.cpp    | 2 +-
 app/Panel/PanelView/krinterdetailedview.cpp | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/Panel/PanelView/krinterbriefview.cpp b/app/Panel/PanelView/krinterbriefview.cpp
index 0691bf241..52f25b41b 100644
--- a/app/Panel/PanelView/krinterbriefview.cpp
+++ b/app/Panel/PanelView/krinterbriefview.cpp
@@ -585,7 +585,7 @@ void KrInterBriefView::renameCurrentItem()
 
     // cycle through various text selections if we are in the editing mode already
     if (state() == QAbstractItemView::EditingState) {
-        auto delegate = dynamic_cast<KrViewItemDelegate *>(itemDelegate(nameIndex));
+        auto delegate = dynamic_cast<KrViewItemDelegate *>(itemDelegateForIndex(nameIndex));
         if (!delegate) {
             qWarning() << "KrInterView item delegate is not KrViewItemDelegate, selection is not updated";
             return;
diff --git a/app/Panel/PanelView/krinterdetailedview.cpp b/app/Panel/PanelView/krinterdetailedview.cpp
index bda2e08dd..bda598b9a 100644
--- a/app/Panel/PanelView/krinterdetailedview.cpp
+++ b/app/Panel/PanelView/krinterdetailedview.cpp
@@ -252,7 +252,7 @@ void KrInterDetailedView::renameCurrentItem()
 
     // cycle through various text selections if we are in the editing mode already
     if (state() == QAbstractItemView::EditingState) {
-        auto delegate = dynamic_cast<KrViewItemDelegate *>(itemDelegate(nameIndex));
+        auto delegate = dynamic_cast<KrViewItemDelegate *>(itemDelegateForIndex(nameIndex));
         if (!delegate) {
             qWarning() << "KrInterView item delegate is not KrViewItemDelegate, selection is not updated";
             return;
-- 
GitLab


From 8f719117639b6308ca2721e02021a9d58e1f5a21 Mon Sep 17 00:00:00 2001
From: Alexander Bikadorov <alex.bikadorov@kdemail.net>
Date: Fri, 27 Sep 2024 16:27:19 +0200
Subject: [PATCH 07/11] Fix all compiler warnings for setting Qt application
 attributes already enabled

---
 app/main.cpp | 4 ----
 1 file changed, 4 deletions(-)

diff --git a/app/main.cpp b/app/main.cpp
index 83fc3fb02..24e0c325c 100644
--- a/app/main.cpp
+++ b/app/main.cpp
@@ -82,10 +82,6 @@ int main(int argc, char *argv[])
     // set global log message format
     qSetMessagePattern(KrServices::GLOBAL_MESSAGE_PATTERN);
 
-    // enable high dpi support
-    QCoreApplication::setAttribute(Qt::AA_UseHighDpiPixmaps, true);
-    QCoreApplication::setAttribute(Qt::AA_EnableHighDpiScaling, true);
-
     // prevent qt5-webengine crashing
     QApplication::setAttribute(Qt::AA_ShareOpenGLContexts);
 
-- 
GitLab


From d5c3aadd0e0c636520fed2b76c11235dac41f94d Mon Sep 17 00:00:00 2001
From: Alexander Bikadorov <alex.bikadorov@kdemail.net>
Date: Fri, 27 Sep 2024 16:34:12 +0200
Subject: [PATCH 08/11] Fix all compiler warnings for deprecated usage of
 QMenu::addAction() method

---
 app/DiskUsage/dufilelight.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/DiskUsage/dufilelight.cpp b/app/DiskUsage/dufilelight.cpp
index 00754b113..51f36a23e 100644
--- a/app/DiskUsage/dufilelight.cpp
+++ b/app/DiskUsage/dufilelight.cpp
@@ -77,8 +77,8 @@ void DUFilelight::mousePressEvent(QMouseEvent *event)
             file = const_cast<File *>(focus->file());
 
         QMenu filelightPopup;
-        filelightPopup.addAction(i18n("Zoom In"), this, SLOT(zoomIn()), Qt::Key_Plus);
-        filelightPopup.addAction(i18n("Zoom Out"), this, SLOT(zoomOut()), Qt::Key_Minus);
+        filelightPopup.addAction(i18n("Zoom In"), Qt::Key_Plus, this, SLOT(zoomIn()));
+        filelightPopup.addAction(i18n("Zoom Out"), Qt::Key_Minus, this, SLOT(zoomOut()));
 
         QMenu schemePopup;
         schemePopup.addAction(i18n("Rainbow"), this, SLOT(schemeRainbow()));
-- 
GitLab


From 43d2a3b7856fb8bb7274667eeb6528be6dd15fe5 Mon Sep 17 00:00:00 2001
From: Alexander Bikadorov <alex.bikadorov@kdemail.net>
Date: Fri, 27 Sep 2024 17:06:11 +0200
Subject: [PATCH 09/11] Fix all "QKeyCombination::operator int()" deprecation
 compiler warnings

---
 app/KViewer/krviewer.h        | 2 +-
 app/Search/krsearchdialog.cpp | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/KViewer/krviewer.h b/app/KViewer/krviewer.h
index 1f1ebf523..a3627e26f 100644
--- a/app/KViewer/krviewer.h
+++ b/app/KViewer/krviewer.h
@@ -117,7 +117,7 @@ private:
     QAction *tabPrevAction;
 
     static QList<KrViewer *> viewers; // the first viewer is the active one
-    QList<int> reservedKeys; // the reserved key sequences
+    QList<QKeyCombination> reservedKeys; // the reserved key sequences
     QList<QAction *> reservedKeyActions; // the IDs of the reserved keys
 
     int sizeX;
diff --git a/app/Search/krsearchdialog.cpp b/app/Search/krsearchdialog.cpp
index 627add9a7..1085a77ae 100644
--- a/app/Search/krsearchdialog.cpp
+++ b/app/Search/krsearchdialog.cpp
@@ -549,7 +549,7 @@ void KrSearchDialog::keyPressEvent(QKeyEvent *e)
         return;
     }
     if (resultView->widget()->hasFocus()) {
-        if ((e->key() | e->modifiers()) == (Qt::CTRL | Qt::Key_I)) {
+        if (e->keyCombination() == QKeyCombination(Qt::CTRL, Qt::Key_I)) {
             searchBar->showBar(KrSearchBar::MODE_FILTER);
         }
         if (e->key() == Qt::Key_Menu) {
-- 
GitLab


From 968b843aca5f60dfa6f05528629e7c628e174b69 Mon Sep 17 00:00:00 2001
From: Alexander Bikadorov <alex.bikadorov@kdemail.net>
Date: Sat, 28 Sep 2024 17:54:44 +0200
Subject: [PATCH 10/11] Fix all "QVariant::type()" deprecation compiler
 warnings

---
 app/Panel/PanelView/krinterbriefview.cpp    | 2 +-
 app/Panel/PanelView/krinterdetailedview.cpp | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/Panel/PanelView/krinterbriefview.cpp b/app/Panel/PanelView/krinterbriefview.cpp
index 52f25b41b..6ecd1763f 100644
--- a/app/Panel/PanelView/krinterbriefview.cpp
+++ b/app/Panel/PanelView/krinterbriefview.cpp
@@ -504,7 +504,7 @@ int KrInterBriefView::elementWidth(const QModelIndex &index)
     textWidth += 2 * textMargin;
 
     QVariant decor = index.data(Qt::DecorationRole);
-    if (decor.isValid() && decor.type() == QVariant::Pixmap) {
+    if (decor.isValid() && decor.typeId() == QMetaType::QPixmap) {
         QPixmap p = decor.value<QPixmap>();
         textWidth += p.width() + 2 * textMargin;
     }
diff --git a/app/Panel/PanelView/krinterdetailedview.cpp b/app/Panel/PanelView/krinterdetailedview.cpp
index bda598b9a..397454f05 100644
--- a/app/Panel/PanelView/krinterdetailedview.cpp
+++ b/app/Panel/PanelView/krinterdetailedview.cpp
@@ -386,7 +386,7 @@ bool KrInterDetailedView::viewportEvent(QEvent *event)
             textWidth += 2 * textMargin;
 
             QVariant decor = index.data(Qt::DecorationRole);
-            if (decor.isValid() && decor.type() == QVariant::Pixmap) {
+            if (decor.isValid() && decor.typeId() == QMetaType::QPixmap) {
                 QPixmap p = decor.value<QPixmap>();
                 textWidth += p.width() + 2 * textMargin;
             }
-- 
GitLab


From 01699e8221de51eecdd4a9d16a525ed746dd4664 Mon Sep 17 00:00:00 2001
From: Alexander Bikadorov <alex.bikadorov@kdemail.net>
Date: Sat, 28 Sep 2024 18:46:10 +0200
Subject: [PATCH 11/11] =?UTF-8?q?Fix=20all=20"conversion=20from=20?=
 =?UTF-8?q?=E2=80=98size=5Ft=E2=80=99"=20compiler=20warnings?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 app/icon.cpp | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/app/icon.cpp b/app/icon.cpp
index d8dd08bc0..2218d0b61 100644
--- a/app/icon.cpp
+++ b/app/icon.cpp
@@ -203,7 +203,7 @@ public:
         return name == x.name && overlays == x.overlays && size == x.size && mode == x.mode && state == x.state;
     }
 
-    uint hash() const
+    size_t hash() const
     {
         return _hash;
     }
@@ -215,10 +215,10 @@ public:
     QIcon::State state;
 
 private:
-    uint _hash;
+    size_t _hash;
 };
 
-uint qHash(const IconCacheKey &key) noexcept
+size_t qHash(const IconCacheKey &key) noexcept
 {
     return key.hash();
 }
-- 
GitLab


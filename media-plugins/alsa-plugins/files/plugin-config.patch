diff --git a/Makefile.am b/Makefile.am
index 69cfe0d..27f61a4 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -1,4 +1,10 @@
-SUBDIRS = oss mix usb_stream arcam-av doc
+SUBDIRS = doc
+if HAVE_OSS
+SUBDIRS += oss
+endif
+if HAVE_MIX
+SUBDIRS += mix
+endif
 if HAVE_JACK
 SUBDIRS += jack
 endif
@@ -8,8 +14,17 @@ endif
 if HAVE_SAMPLERATE
 SUBDIRS += rate
 endif
-if HAVE_AVCODEC
-SUBDIRS += a52 rate-lavc
+if HAVE_A52
+SUBDIRS += a52
+endif
+if HAVE_LAVRATE
+SUBDIRS += rate-lav
+endif
+if HAVE_USBSTREAM
+SUBDIRS += usb_stream
+endif
+if HAVE_ARCAMAV
+SUBDIRS += arcam-av
 endif
 if HAVE_MAEMO_PLUGIN
 SUBDIRS += maemo
diff --git a/a52/60-a52-encoder.conf b/a52/60-a52-encoder.conf
new file mode 100644
index 0000000..346c94f
--- /dev/null
+++ b/a52/60-a52-encoder.conf
@@ -0,0 +1,38 @@
+pcm.a52 {
+	@args [ CARD SLAVE RATE BITRATE CHANNELS ]
+	@args.CARD {
+		type integer
+		default {
+			@func refer
+			name defaults.pcm.card
+		}
+	}
+	@args.SLAVE {
+		type string
+	}
+	@args.RATE {
+		type integer
+		default 48000
+	}
+	@args.BITRATE {
+		type integer
+		default 448
+	}
+	@args.CHANNELS {
+		type string
+		default 6
+	}
+	type a52
+	card $CARD
+	slavepcm $SLAVE
+	rate $RATE
+	bitrate $BITRATE
+	channels $CHANNELS
+	hint {
+		show {
+			@func refer
+			name defaults.namehint.basic
+		}
+                description "Plugin to convert multichannel stream to A52 (AC3) bitstream"
+	}
+}
diff --git a/a52/Makefile.am b/a52/Makefile.am
index 48567b4..cd5ce45 100644
--- a/a52/Makefile.am
+++ b/a52/Makefile.am
@@ -1,10 +1,21 @@
+GCONF_FILES = 60-a52-encoder.conf
+
+EXTRA_DIST = $(GCONF_FILES)
+
 asound_module_pcm_a52_LTLIBRARIES = libasound_module_pcm_a52.la
+asound_module_gconf_DATA = $(GCONF_FILES)
 
 asound_module_pcm_a52dir = @ALSA_PLUGIN_DIR@
+asound_module_gconfdir = @ALSA_GCONF_DIR@
 
-AM_CFLAGS = -Wall -g @ALSA_CFLAGS@ @AVCODEC_CFLAGS@ \
-	-DAVCODEC_HEADER="@AVCODEC_HEADER@"
+AM_CFLAGS = -Wall -g @ALSA_CFLAGS@ @LIBAV_CFLAGS@
 AM_LDFLAGS = -module -avoid-version -export-dynamic -no-undefined $(LDFLAGS_NOUNDEFINED)
 
 libasound_module_pcm_a52_la_SOURCES = pcm_a52.c
-libasound_module_pcm_a52_la_LIBADD = @ALSA_LIBS@ @AVCODEC_LIBS@
+libasound_module_pcm_a52_la_LIBADD = @ALSA_LIBS@ @LIBAV_LIBS@ @LIBAV_CODEC_LIBS@
+
+include ../install-hooks.am
+
+install-data-hook: install-conf-hook
+
+uninstall-local: uninstall-conf-hook
diff --git a/a52/pcm_a52.c b/a52/pcm_a52.c
index 348d58f..29ce45f 100644
--- a/a52/pcm_a52.c
+++ b/a52/pcm_a52.c
@@ -25,7 +25,7 @@
 #include <alsa/asoundlib.h>
 #include <alsa/pcm_external.h>
 #include <alsa/pcm_plugin.h>
-#include AVCODEC_HEADER
+#include <libavcodec/avcodec.h>
 #include <libavutil/avutil.h>
 
 /* some compatibility wrappers */
@@ -937,7 +937,7 @@ SND_PCM_PLUGIN_DEFINE_FUNC(a52)
 		goto error;
 	}
 
-	if (! pcm_string) {
+	if (! pcm_string || pcm_string[0] == '\0') {
 		snprintf(devstr, sizeof(devstr),
 			 "iec958:{AES0 0x%x AES1 0x%x AES2 0x%x AES3 0x%x %s%s}",
 			 IEC958_AES0_CON_EMPHASIS_NONE | IEC958_AES0_NONAUDIO |
diff --git a/arcam-av/50-arcam-av-ctl.conf b/arcam-av/50-arcam-av-ctl.conf
new file mode 100644
index 0000000..b76caa9
--- /dev/null
+++ b/arcam-av/50-arcam-av-ctl.conf
@@ -0,0 +1,16 @@
+ctl.arcam_av {
+	@args [ PORT ]
+	@args.PORT {
+		type string
+		default "/dev/ttyUSB0"
+	}
+	type arcam_av
+	port $PORT
+	hint {
+		show {
+			@func refer
+			name defaults.namehint.basic
+		}
+		description "Arcam-AV Amplifier"
+	}
+}
diff --git a/arcam-av/Makefile.am b/arcam-av/Makefile.am
index 5c7855f..57d5542 100644
--- a/arcam-av/Makefile.am
+++ b/arcam-av/Makefile.am
@@ -1,9 +1,21 @@
+GCONF_FILES = 50-arcam-av-ctl.conf
+
+EXTRA_DIST = $(GCONF_FILES)
+
 asound_module_ctl_arcam_av_LTLIBRARIES = libasound_module_ctl_arcam_av.la
+asound_module_gconf_DATA = $(GCONF_FILES)
 
 asound_module_ctl_arcam_avdir = @ALSA_PLUGIN_DIR@
+asound_module_gconfdir = @ALSA_GCONF_DIR@
 
 AM_CFLAGS = -Wall -g @ALSA_CFLAGS@
 AM_LDFLAGS = -module -avoid-version -export-dynamic -no-undefined
 
 libasound_module_ctl_arcam_av_la_SOURCES = ctl_arcam_av.c arcam_av.c arcam_av.h
-libasound_module_ctl_arcam_av_la_LIBADD = @ALSA_LIBS@
+libasound_module_ctl_arcam_av_la_LIBADD = @ALSA_LIBS@ -lpthread
+
+include ../install-hooks.am
+
+install-data-hook: install-conf-hook
+
+uninstall-local: uninstall-conf-hook
diff --git a/configure.ac b/configure.ac
index ecc265b..cc3740b 100644
--- a/configure.ac
+++ b/configure.ac
@@ -16,7 +16,7 @@ AC_HEADER_STDC
 
 CC_NOUNDEFINED
 
-PKG_CHECK_MODULES(ALSA, alsa >= 1.0.11)
+PKG_CHECK_MODULES(ALSA, alsa >= 1.1.6)
 AC_CHECK_LIB(asound, snd_pcm_ioplug_create,,
 	     AC_ERROR([*** libasound has no external plugin SDK]), -ldl)
 
@@ -89,51 +89,55 @@ if test "$use_maemo_rm" = "yes"; then
         fi
 fi
 
-AC_ARG_ENABLE([avcodec],
-      AS_HELP_STRING([--disable-avcodec], [Don't build plugins depending on avcodec (a52)]))
+AC_ARG_ENABLE([libav],
+      AS_HELP_STRING([--disable-libav], [Do not build plugins depending on libav/ffmpeg (a52,lavrate...)]))
 
-if test "x$enable_avcodec" != "xno"; then
-  PKG_CHECK_MODULES(AVCODEC, [libavcodec libavutil], [HAVE_AVCODEC=yes], [HAVE_AVCODEC=no])
+if test "x$enable_libav" != "xno"; then
+  PKG_CHECK_MODULES(LIBAV, [libavcodec libavutil libavresample], [HAVE_LIBAV=yes], [HAVE_LIBAV=no])
 fi
 
-if test "x$HAVE_AVCODEC" = "xno"; then
-  AC_ARG_WITH([avcodec-includedir],
-	AS_HELP_STRING([--with-avcodec-includedir=dir],
-		[AVcodec include directory]),
-	[AVCODEC_CFLAGS="-I$withval"], [AVCODEC_CFLAGS=""])
-  AC_ARG_WITH([avcodec-libdir],
-	AS_HELP_STRING([--with-avcodec-libdir=dir],
-		[AVcodec library directory]),
-	[AVCODEC_LIBS="-L$withval"], [AVCODEC_LIBS=""])
+if test "x$HAVE_LIBAV" = "xno"; then
+  AC_ARG_WITH([libav-includedir],
+	AS_HELP_STRING([--with-libav-includedir=dir],
+		[Libav/ffmpeg include directory]),
+		[LIBAV_CFLAGS="-I$(withval)"], [LIBAV_CFLAGS=""])
+  AC_ARG_WITH([libav-libdir],
+	AS_HELP_STRING([--with-libav-libdir=dir],
+		[Libav/ffmpeg library directory]),
+		[LIBAV_LIBS="-L$withval"], [LIBAV_LIBS=""])
 
   CFLAGS_saved="$CFLAGS"
   LDFLAGS_saved="$LDFLAGS"
-  CFLAGS="$CFLAGS $AVCODEC_CFLAGS"
-  LDFLAGS="$LDFLAGS $AVCODEC_LIBS"
-  AVCODEC_LIBS="$AVCODEC_LIBS -lavcodec"
-  AC_CHECK_LIB([avcodec], [avcodec_open], [HAVE_AVCODEC=yes], [HAVE_AVCODEC=no])
+  CFLAGS="$CFLAGS $LIBAV_CFLAGS"
+  LDFLAGS="$LDFLAGS $LIBAV_LIBS"
+  AC_CHECK_LIB([avcodec], [avcodec_open], [HAVE_LIBAV=yes], [HAVE_LIBAV=no])
   CFLAGS="$CFLAGS_saved"
   LDFLAGS="$LDFLAGS_saved"
+  LIBAV_CODEC_LIBS="-lavcodec"
+  LIBAV_RESAMPLE_LIBS="-lavresample -lavutil"
 fi
 
-if test $HAVE_AVCODEC = yes; then
-  AVCODEC_HEADER=""
-  CFLAGS_saved="$CFLAGS"
-  CFLAGS="$CFLAGS $AVCODEC_CFLAGS"
-  AC_CHECK_HEADER([ffmpeg/avcodec.h], [AVCODEC_HEADER='<ffmpeg/avcodec.h>'])
-  if test -z "$AVCODEC_HEADER"; then
-    AC_CHECK_HEADER([libavcodec/avcodec.h], [AVCODEC_HEADER='<libavcodec/avcodec.h>'])
-  fi
-  if test -z "$AVCODEC_HEADER"; then
-    HAVE_AVCODEC=no
-  fi
-  CFLAGS="$CFLAGS_saved"
+AM_CONDITIONAL(HAVE_LIBAV, test x$HAVE_LIBAV = xyes)
+AC_SUBST(LIBAV_CFLAGS)
+AC_SUBST(LIBAV_LIBS)
+AC_SUBST(LIBAV_CODEC_LIBS)
+AC_SUBST(LIBAV_RESAMPLE_LIBS)
+
+AC_ARG_ENABLE([a52],
+      AS_HELP_STRING([--disable-a52], [Disable building of A52 encoder plugin]))
+
+if test "x$enable_a52" != "xno" -a "$HAVE_LIBAV" = "yes"; then
+  HAVE_A52=yes
 fi
+AM_CONDITIONAL(HAVE_A52, test x$HAVE_A52 = xyes)
 
-AM_CONDITIONAL(HAVE_AVCODEC, test x$HAVE_AVCODEC = xyes)
-AC_SUBST(AVCODEC_CFLAGS)
-AC_SUBST(AVCODEC_LIBS)
-AC_SUBST(AVCODEC_HEADER)
+AC_ARG_ENABLE([lavrate],
+      AS_HELP_STRING([--disable-lavrate], [Disable building of libav/ffmpeg rate plugin]))
+
+if test "x$enable_lavrate" != "xno" -a "$HAVE_LIBAV" = "yes"; then
+  HAVE_LAVRATE=yes
+fi
+AM_CONDITIONAL(HAVE_LAVRATE, test x$HAVE_LAVRATE = xyes)
 
 AC_ARG_ENABLE([speexdsp],
       AS_HELP_STRING([--disable-speexdsp], [Disable building of speexdsp plugin]))
@@ -206,6 +210,30 @@ AC_DEFINE_UNQUOTED(ALSA_DATA_DIR, "$alsadatadir", [directory containing ALSA dat
 ALSA_DATA_DIR="$alsadatadir"
 AC_SUBST(ALSA_DATA_DIR)
 
+dnl ALSA add-on global config directory
+AC_ARG_WITH(alsagconfdir,
+    AS_HELP_STRING([--with-alsagconfdir=dir],
+	[path where ALSA global add-on config files are stored]),
+    alsagconfdir="$withval", alsagconfdir="")
+if test -z "$alsagconfdir"; then
+    alsagconfdir="$ALSA_DATA_DIR/alsa.conf.d"
+fi
+AC_DEFINE_UNQUOTED(ALSA_GCONF_DIR, "$alsagconfdir", [directory containing global ALSA add-on config files])
+ALSA_GCONF_DIR="$alsagconfdir"
+AC_SUBST(ALSA_GCONF_DIR)
+
+dnl ALSA add-on local config directory
+AC_ARG_WITH(alsalconfdir,
+    AS_HELP_STRING([--with-alsalconfdir=dir],
+	[path where ALSA local add-on config files are stored]),
+    alsalconfdir="$withval", alsalconfdir="")
+if test -z "$alsalconfdir"; then
+    alsalconfdir="/etc/alsa/conf.d"
+fi
+AC_DEFINE_UNQUOTED(ALSA_LCONF_DIR, "$alsalconfdir", [directory containing local ALSA add-on config files])
+ALSA_LCONF_DIR="$alsalconfdir"
+AC_SUBST(ALSA_LCONF_DIR)
+
 SAVE_PLUGINS_VERSION
 
 AC_OUTPUT([
@@ -217,7 +245,7 @@ AC_OUTPUT([
 	mix/Makefile
 	rate/Makefile
 	a52/Makefile
-	rate-lavc/Makefile
+	rate-lav/Makefile
 	maemo/Makefile
 	doc/Makefile
 	usb_stream/Makefile
@@ -248,12 +276,13 @@ if test "$HAVE_SAMPLERATE" = "yes"; then
 fi
 echo "Maemo plugin:       $HAVE_MAEMO_PLUGIN"
 echo "  Using Osso resource manager: $use_maemo_rm"
-echo "A52, lavc plugins:  $HAVE_AVCODEC"
-if test "$HAVE_AVCODEC" = "yes"; then
-  echo "  AVCODEC_CFLAGS: $AVCODEC_CFLAGS"
-  echo "  AVCODEC_LIBS: $AVCODEC_LIBS"
-  echo "  AVCODEC_HEADER: $AVCODEC_HEADER"
+if test "$HAVE_LIBAV" = "yes"; then
+  echo "Libav/ffmpeg config:"
+  echo "  LIBAV_CFLAGS:   $LIBAV_CFLAGS"
+  echo "  LIBAV_LIBS:     $LIBAV_LIBS / $LIBAV_CODEC_LIBS / $LIBAV_RESAMPLE_LIBS"
 fi
+echo "Libav A52 plugin:   $HAVE_A52"
+echo "Libav rate plugin:  $HAVE_LAVRATE"
 echo "Speex rate plugin:  $PPH"
 echo "Speex preprocess plugin:  $HAVE_SPEEXDSP"
 if test "$HAVE_SPEEX" = "yes"; then
diff --git a/doc/Makefile.am b/doc/Makefile.am
index 19fa0d2..7c004e5 100644
--- a/doc/Makefile.am
+++ b/doc/Makefile.am
@@ -1,4 +1,35 @@
-EXTRA_DIST = README-pcm-oss README-jack README-pulse README-maemo \
-	upmix.txt vdownmix.txt samplerate.txt a52.txt lavcrate.txt \
-	speexrate.txt speexdsp.txt README-arcam-av
+EXTRA_DIST =
 
+if HAVE_OSS
+EXTRA_DIST += README-pcm-oss
+endif
+if HAVE_MIX
+EXTRA_DIST += upmix.txt vdownmix.txt
+endif
+if HAVE_JACK
+EXTRA_DIST += README-jack
+endif
+if HAVE_PULSE
+EXTRA_DIST += README-pulse
+endif
+if HAVE_MAEMO_PLUGIN
+EXTRA_DIST += README-maemo
+endif
+if HAVE_SAMPLERATE
+EXTRA_DIST += samplerate.txt
+endif
+if HAVE_A52
+EXTRA_DIST += a52.txt
+endif
+if HAVE_LAVRATE
+EXTRA_DIST += lavrate.txt
+endif
+if HAVE_PPH
+EXTRA_DIST += speexrate.txt
+endif
+if HAVE_SPEEXDSP
+EXTRA_DIST += speexdsp.txt
+endif
+if HAVE_ARCAMAV
+EXTRA_DIST += README-arcam-av
+endif
diff --git a/doc/lavcrate.txt b/doc/lavrate.txt
similarity index 76%
rename from doc/lavcrate.txt
rename to doc/lavrate.txt
index faf3e25..6575183 100644
--- a/doc/lavcrate.txt
+++ b/doc/lavrate.txt
@@ -1,14 +1,14 @@
-Rate Converter Plugin Using libavcodec
-======================================
+Rate Converter Plugin Using libavresample
+=========================================0
 
-The plugin in rate-lavc subdirectory is an external rate converter using
-libavcodec's resampler.  You can use this rate converter plugin by defining a
+The plugin in rate-lavr subdirectory is an external rate converter using
+libavresample library. You can use this rate converter plugin by defining a
 rate PCM with "converter" parameter, such as:
 
 	pcm.my_rate {
 		type rate
 		slave.pcm "hw"
-		converter "lavcrate"
+		converter "lavrate"
 	}
 
 The plug plugin has also a similar field, "rate_converter".
diff --git a/install-hooks.am b/install-hooks.am
new file mode 100644
index 0000000..2d6d383
--- /dev/null
+++ b/install-hooks.am
@@ -0,0 +1,16 @@
+install-conf-hook:
+	mkdir -p $(DESTDIR)$(ALSA_LCONF_DIR)
+	@(echo cd $(DESTDIR)$(ALSA_LCONF_DIR);			\
+	  cd $(DESTDIR)$(ALSA_LCONF_DIR);			\
+	  for i in $(GCONF_FILES); do				\
+	    echo $(RM) $$i";" ln -s $(ALSA_GCONF_DIR)/$$i .;	\
+	    $(RM) $$i;						\
+	    ln -s $(ALSA_GCONF_DIR)/$$i .;			\
+	  done)
+uninstall-conf-hook:
+	@(echo cd $(DESTDIR)$(ALSA_LCONF_DIR);			\
+	  cd $(DESTDIR)$(ALSA_LCONF_DIR);			\
+	  for i in $(GCONF_FILES); do				\
+	    echo $(RM) $$i;					\
+	    $(RM) $$i;						\
+	  done)
diff --git a/jack/50-jack.conf b/jack/50-jack.conf
new file mode 100644
index 0000000..d780dfc
--- /dev/null
+++ b/jack/50-jack.conf
@@ -0,0 +1,18 @@
+pcm.jack {
+	type jack
+	playback_ports {
+		0 alsa_pcm:playback_1
+		1 alsa_pcm:playback_2
+	}
+	capture_ports {
+		0 alsa_pcm:capture_1
+		1 alsa_pcm:capture_2
+	}
+	hint {
+		show {
+			@func refer
+			name defaults.namehint.basic
+		}
+		description "JACK Audio Connection Kit"
+	}
+}
diff --git a/jack/Makefile.am b/jack/Makefile.am
index f913cb6..7801194 100644
--- a/jack/Makefile.am
+++ b/jack/Makefile.am
@@ -1,9 +1,21 @@
+GCONF_FILES = 50-jack.conf
+
+EXTRA_DIST = $(GCONF_FILES)
+
 asound_module_pcm_jack_LTLIBRARIES = libasound_module_pcm_jack.la
+asound_module_gconf_DATA = $(GCONF_FILES)
 
 asound_module_pcm_jackdir = @ALSA_PLUGIN_DIR@
+asound_module_gconfdir = @ALSA_GCONF_DIR@
 
 AM_CFLAGS = -Wall -g @ALSA_CFLAGS@ @JACK_CFLAGS@
 AM_LDFLAGS = -module -avoid-version -export-dynamic -no-undefined $(LDFLAGS_NOUNDEFINED)
 
 libasound_module_pcm_jack_la_SOURCES = pcm_jack.c
 libasound_module_pcm_jack_la_LIBADD = @ALSA_LIBS@ @JACK_LIBS@
+
+include ../install-hooks.am
+
+install-data-hook: install-conf-hook
+
+uninstall-local: uninstall-conf-hook
diff --git a/jack/pcm_jack.c b/jack/pcm_jack.c
index e3df4d2..b39835e 100644
--- a/jack/pcm_jack.c
+++ b/jack/pcm_jack.c
@@ -29,6 +29,8 @@
 #include <alsa/asoundlib.h>
 #include <alsa/pcm_external.h>
 
+#define MAX_PERIODS_MULTIPLE 64
+
 typedef enum _jack_format {
 	SND_PCM_JACK_FORMAT_RAW
 } snd_pcm_jack_format_t;
@@ -58,17 +60,27 @@ typedef struct {
 
 static int snd_pcm_jack_stop(snd_pcm_ioplug_t *io);
 
+/* snd_pcm_ioplug_avail() was introduced after alsa-lib 1.1.6 */
+#if SND_LIB_VERSION < 0x10107
+static snd_pcm_uframes_t snd_pcm_ioplug_avail(const snd_pcm_ioplug_t *io,
+					      const snd_pcm_uframes_t hw_ptr,
+					      const snd_pcm_uframes_t appl_ptr)
+{
+	return io->buffer_size - snd_pcm_ioplug_hw_avail(io, hw_ptr, appl_ptr);
+}
+#endif
 
 static int pcm_poll_block_check(snd_pcm_ioplug_t *io)
 {
 	static char buf[32];
-	snd_pcm_sframes_t avail;
+	snd_pcm_uframes_t avail;
 	snd_pcm_jack_t *jack = io->private_data;
 
 	if (io->state == SND_PCM_STATE_RUNNING ||
+	    io->state == SND_PCM_STATE_DRAINING ||
 	    (io->state == SND_PCM_STATE_PREPARED && io->stream == SND_PCM_STREAM_CAPTURE)) {
-		avail = snd_pcm_avail_update(io->pcm);
-		if (avail >= 0 && avail < jack->min_avail) {
+		avail = snd_pcm_ioplug_avail(io, jack->hw_ptr, io->appl_ptr);
+		if (avail < jack->min_avail) {
 			while (read(io->poll_fd, &buf, sizeof(buf)) == sizeof(buf))
 				;
 			return 1;
@@ -81,11 +93,16 @@ static int pcm_poll_block_check(snd_pcm_ioplug_t *io)
 static int pcm_poll_unblock_check(snd_pcm_ioplug_t *io)
 {
 	static char buf[1];
-	snd_pcm_sframes_t avail;
+	snd_pcm_uframes_t avail;
 	snd_pcm_jack_t *jack = io->private_data;
 
-	avail = snd_pcm_avail_update(io->pcm);
-	if (avail < 0 || avail >= jack->min_avail) {
+	avail = snd_pcm_ioplug_avail(io, jack->hw_ptr, io->appl_ptr);
+	/* In draining state poll_fd is used to wait
+	 * till all pending frames are played.
+	 * Therefore it has to be guarantee that a poll event is also generated
+	 * if the buffer contains less than min_avail frames
+	 */
+	if (avail >= jack->min_avail || io->state == SND_PCM_STATE_DRAINING) {
 		write(jack->fd, &buf, 1);
 		return 1;
 	}
@@ -161,7 +178,8 @@ snd_pcm_jack_process_cb(jack_nframes_t nframes, snd_pcm_ioplug_t *io)
 		jack->areas[channel].step = jack->sample_bits;
 	}
 
-	if (io->state == SND_PCM_STATE_RUNNING) {
+	if (io->state == SND_PCM_STATE_RUNNING ||
+	    io->state == SND_PCM_STATE_DRAINING) {
 		snd_pcm_uframes_t hw_ptr = jack->hw_ptr;
 		const snd_pcm_uframes_t hw_avail = snd_pcm_ioplug_hw_avail(io, hw_ptr,
 									   io->appl_ptr);
@@ -348,8 +366,20 @@ static int jack_set_hw_constraint(snd_pcm_jack_t *jack)
 	};
 	unsigned int format = SND_PCM_FORMAT_FLOAT;
 	unsigned int rate = jack_get_sample_rate(jack->client);
+	unsigned int psize_list[MAX_PERIODS_MULTIPLE];
+	unsigned int nframes = jack_get_buffer_size(jack->client);
+	unsigned int jack_buffer_bytes = (snd_pcm_format_size(format, nframes) *
+					  jack->channels);
+	unsigned int i;
 	int err;
 
+	if (!jack_buffer_bytes) {
+		SNDERR("Buffer size is zero");
+		return -EINVAL;
+	}
+	for (i = 1; i <= ARRAY_SIZE(psize_list); i++)
+		psize_list[i-1] = jack_buffer_bytes * i;
+
 	jack->sample_bits = snd_pcm_format_physical_width(format);
 	if ((err = snd_pcm_ioplug_set_param_list(&jack->io, SND_PCM_IOPLUG_HW_ACCESS,
 						 ARRAY_SIZE(access_list), access_list)) < 0 ||
@@ -359,8 +389,8 @@ static int jack_set_hw_constraint(snd_pcm_jack_t *jack)
 						   jack->channels, jack->channels)) < 0 ||
 	    (err = snd_pcm_ioplug_set_param_minmax(&jack->io, SND_PCM_IOPLUG_HW_RATE,
 						   rate, rate)) < 0 ||
-	    (err = snd_pcm_ioplug_set_param_minmax(&jack->io, SND_PCM_IOPLUG_HW_PERIOD_BYTES,
-						   128, 64*1024)) < 0 ||
+	    (err = snd_pcm_ioplug_set_param_list(&jack->io, SND_PCM_IOPLUG_HW_PERIOD_BYTES,
+						 ARRAY_SIZE(psize_list), psize_list)) < 0 ||
 	    (err = snd_pcm_ioplug_set_param_minmax(&jack->io, SND_PCM_IOPLUG_HW_PERIODS,
 						   2, 64)) < 0)
 		return err;
diff --git a/maemo/98-maemo.conf b/maemo/98-maemo.conf
new file mode 100644
index 0000000..a9ad6a0
--- /dev/null
+++ b/maemo/98-maemo.conf
@@ -0,0 +1,11 @@
+pcm.!default {
+	type alsa_dsp
+	playback_device_file [ "/dev/dsptask/pcm2" ]
+	recording_device_file [ "/dev/dsptask/pcm_rec" ]
+}
+
+ctl.!default {
+	type dsp_ctl
+	playback_devices [ "/dev/dsptask/pcm2" ]
+	recording_devices [ "/dev/dsptask/pcm_rec" ]
+}
diff --git a/maemo/Makefile.am b/maemo/Makefile.am
index 2684781..7749926 100644
--- a/maemo/Makefile.am
+++ b/maemo/Makefile.am
@@ -1,8 +1,14 @@
+GCONF_FILES = 98-maemo.conf
+
+EXTRA_DIST = $(GCONF_FILES)
+
 asound_module_pcm_alsa_dsp_LTLIBRARIES = libasound_module_pcm_alsa_dsp.la
 asound_module_ctl_dsp_ctl_LTLIBRARIES = libasound_module_ctl_dsp_ctl.la
+asound_module_gconf_DATA = $(GCONF_FILES)
 
 asound_module_pcm_alsa_dspdir = @ALSA_PLUGIN_DIR@
 asound_module_ctl_dsp_ctldir = @ALSA_PLUGIN_DIR@
+asound_module_gconfdir = @ALSA_GCONF_DIR@
 
 AM_CFLAGS = -Wall -O2 @ALSA_CFLAGS@ $(DBUS_CFLAGS)
 AM_LDFLAGS = -module -avoid-version -export-dynamic -no-undefined $(LDFLAGS_NOUNDEFINED)
@@ -15,3 +21,9 @@ libasound_module_ctl_dsp_ctl_la_LIBADD = @ALSA_LIBS@ $(DBUS_LIBS) -lpthread
 
 noinst_HEADERS = constants.h debug.h dsp-protocol.h list.h reporting.h \
 	         types.h
+
+include ../install-hooks.am
+
+install-data-hook: install-conf-hook
+
+uninstall-local: uninstall-conf-hook
diff --git a/mix/60-upmix.conf b/mix/60-upmix.conf
new file mode 100644
index 0000000..028cfe1
--- /dev/null
+++ b/mix/60-upmix.conf
@@ -0,0 +1,26 @@
+pcm.upmix {
+	@args [ SLAVE CHANNELS DELAY ]
+	@args.SLAVE {
+		type string
+		default "plug:hw"
+	}
+	@args.CHANNELS {
+		type integer
+		default 6
+	}
+	@args.DELAY {
+		type integer
+		default 0
+	}
+	type upmix
+	channels $CHANNELS
+	delay $DELAY
+	slave.pcm $SLAVE
+	hint {
+		show {
+			@func refer
+			name defaults.namehint.basic
+		}
+                description "Plugin for channel upmix (4,6,8)"
+	}
+}
diff --git a/mix/60-vdownmix.conf b/mix/60-vdownmix.conf
new file mode 100644
index 0000000..32e9c56
--- /dev/null
+++ b/mix/60-vdownmix.conf
@@ -0,0 +1,24 @@
+pcm.vdownmix {
+	@args [ SLAVE CHANNELS DELAY ]
+	@args.SLAVE {
+		type string
+		default "plug:hw"
+	}
+	@args.CHANNELS {
+		type integer
+		default 6
+	}
+	@args.DELAY {
+		type integer
+		default 0
+	}
+	type vdownmix
+	slave.pcm $SLAVE
+	hint {
+		show {
+			@func refer
+			name defaults.namehint.basic
+		}
+                description "Plugin for channel downmix (stereo) with a simple spacialization"
+	}
+}
diff --git a/mix/Makefile.am b/mix/Makefile.am
index e31839a..a74c200 100644
--- a/mix/Makefile.am
+++ b/mix/Makefile.am
@@ -1,8 +1,14 @@
+GCONF_FILES = 60-upmix.conf 60-vdownmix.conf
+
+EXTRA_DIST = $(GCONF_FILES)
+
 asound_module_pcm_upmix_LTLIBRARIES = libasound_module_pcm_upmix.la
 asound_module_pcm_vdownmix_LTLIBRARIES = libasound_module_pcm_vdownmix.la
+asound_module_gconf_DATA = $(GCONF_FILES)
 
 asound_module_pcm_upmixdir = @ALSA_PLUGIN_DIR@
 asound_module_pcm_vdownmixdir = @ALSA_PLUGIN_DIR@
+asound_module_gconfdir = @ALSA_GCONF_DIR@
 
 AM_CFLAGS = -Wall -g @ALSA_CFLAGS@
 AM_LDFLAGS = -module -avoid-version -export-dynamic -no-undefined $(LDFLAGS_NOUNDEFINED)
@@ -12,3 +18,8 @@ libasound_module_pcm_upmix_la_LIBADD = @ALSA_LIBS@
 libasound_module_pcm_vdownmix_la_SOURCES = pcm_vdownmix.c
 libasound_module_pcm_vdownmix_la_LIBADD = @ALSA_LIBS@
 
+include ../install-hooks.am
+
+install-data-hook: install-conf-hook
+
+uninstall-local: uninstall-conf-hook
diff --git a/oss/50-oss.conf b/oss/50-oss.conf
new file mode 100644
index 0000000..5b2817b
--- /dev/null
+++ b/oss/50-oss.conf
@@ -0,0 +1,26 @@
+pcm.oss {
+	@args [ DEVICE ]
+	@args.DEVICE {
+		type string
+		default "/dev/dsp"
+	}
+	type oss
+	port $DEVICE
+	hint {
+		show {
+			@func refer
+			name defaults.namehint.basic
+		}
+		description "Open Sound System"
+	}
+}
+
+ctl.oss {
+	@args [ DEVICE ]
+	@args.DEVICE {
+		type string
+		default "/dev/mixer"
+	}
+	type oss
+	device $DEVICE
+}
diff --git a/oss/Makefile.am b/oss/Makefile.am
index 302538b..bff4443 100644
--- a/oss/Makefile.am
+++ b/oss/Makefile.am
@@ -1,8 +1,14 @@
+GCONF_FILES = 50-oss.conf
+
+EXTRA_DIST = $(GCONF_FILES)
+
 asound_module_pcm_oss_LTLIBRARIES = libasound_module_pcm_oss.la
 asound_module_ctl_oss_LTLIBRARIES = libasound_module_ctl_oss.la
+asound_module_gconf_DATA = $(GCONF_FILES)
 
 asound_module_pcm_ossdir = @ALSA_PLUGIN_DIR@
 asound_module_ctl_ossdir = @ALSA_PLUGIN_DIR@
+asound_module_gconfdir = @ALSA_GCONF_DIR@
 
 AM_CFLAGS = -Wall -g @ALSA_CFLAGS@
 AM_LDFLAGS = -module -avoid-version -export-dynamic -no-undefined $(LDFLAGS_NOUNDEFINED)
@@ -12,3 +18,9 @@ libasound_module_pcm_oss_la_LIBADD = @ALSA_LIBS@
 
 libasound_module_ctl_oss_la_SOURCES = ctl_oss.c
 libasound_module_ctl_oss_la_LIBADD = @ALSA_LIBS@
+
+include ../install-hooks.am
+
+install-data-hook: install-conf-hook
+
+uninstall-local: uninstall-conf-hook
diff --git a/pph/10-speexrate.conf b/pph/10-speexrate.conf
new file mode 100644
index 0000000..1d9eae9
--- /dev/null
+++ b/pph/10-speexrate.conf
@@ -0,0 +1,28 @@
+pcm.speexrate {
+	@args [ SLAVE RATE CONVERTER ]
+	@args.SLAVE {
+		type string
+		default "plug:hw"
+	}
+	@args.RATE {
+		type integer
+		default 48000
+	}
+	@args.CONVERTER {
+		type string
+		default "speexrate"
+	}
+	type rate
+	converter $CONVERTER
+	slave {
+		pcm $SLAVE
+		rate $RATE
+	}
+	hint {
+		show {
+			@func refer
+			name defaults.namehint.basic
+		}
+                description "Rate Converter Plugin Using Speex Resampler"
+	}
+}
diff --git a/pph/Makefile.am b/pph/Makefile.am
index 551e5bd..6938b74 100644
--- a/pph/Makefile.am
+++ b/pph/Makefile.am
@@ -1,6 +1,12 @@
+GCONF_FILES = 10-speexrate.conf
+
+EXTRA_DIST = $(GCONF_FILES)
+
 asound_module_rate_speexrate_LTLIBRARIES = libasound_module_rate_speexrate.la
+asound_module_gconf_DATA = $(GCONF_FILES)
 
 asound_module_rate_speexratedir = @ALSA_PLUGIN_DIR@
+asound_module_gconfdir = @ALSA_GCONF_DIR@
 
 AM_CFLAGS = -DVAR_ARRAYS -Wall -g @ALSA_CFLAGS@
 AM_LDFLAGS = -module -avoid-version -export-dynamic -no-undefined $(LDFLAGS_NOUNDEFINED)
@@ -16,6 +22,10 @@ libasound_module_rate_speexrate_la_SOURCES += resample.c
 libasound_module_rate_speexrate_la_LIBADD += -lm
 endif
 
+noinst_HEADERS = speex_resampler.h arch.h fixed_generic.h
+
+include ../install-hooks.am
+
 install-exec-hook:
 	rm -f $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_speexrate_*.so
 	$(LN_S) libasound_module_rate_speexrate.so $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_speexrate_best.so
@@ -24,4 +34,6 @@ install-exec-hook:
 uninstall-hook:
 	rm -f $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_speexrate_*.so
 
-noinst_HEADERS = speex_resampler.h arch.h fixed_generic.h
+install-data-hook: install-conf-hook
+
+uninstall-local: uninstall-conf-hook
diff --git a/pulse/50-pulseaudio.conf b/pulse/50-pulseaudio.conf
index dd85dab..62da207 100644
--- a/pulse/50-pulseaudio.conf
+++ b/pulse/50-pulseaudio.conf
@@ -1,13 +1,16 @@
 # Add a specific named PulseAudio pcm and ctl (typically useful for testing)
 
 pcm.pulse {
-    type pulse
-    hint {
-        show on
-        description "PulseAudio Sound Server"
-    }
+	type pulse
+	hint {
+		show {
+			@func refer
+			name defaults.namehint.basic
+		}
+		description "PulseAudio Sound Server"
+	}
 }
 
 ctl.pulse {
-    type pulse
+	type pulse
 }
diff --git a/pulse/Makefile.am b/pulse/Makefile.am
index a5550b9..c33e702 100644
--- a/pulse/Makefile.am
+++ b/pulse/Makefile.am
@@ -1,14 +1,19 @@
-EXTRA_DIST = 50-pulseaudio.conf 99-pulseaudio-default.conf.example
+GCONF_FILES = 50-pulseaudio.conf
+LCONF_FILES = 99-pulseaudio-default.conf.example
+
+EXTRA_DIST = $(GCONF_FILES) $(LCONF_FILES)
 
 asound_module_pcm_LTLIBRARIES = libasound_module_pcm_pulse.la
 asound_module_ctl_LTLIBRARIES = libasound_module_ctl_pulse.la
 asound_module_conf_LTLIBRARIES = libasound_module_conf_pulse.la
-asound_module_data_DATA = 50-pulseaudio.conf 99-pulseaudio-default.conf.example
+asound_module_gconf_DATA = $(GCONF_FILES)
+asound_module_lconf_DATA = $(LCONF_FILES)
 
 asound_module_pcmdir = @ALSA_PLUGIN_DIR@
 asound_module_ctldir = @ALSA_PLUGIN_DIR@
 asound_module_confdir = @ALSA_PLUGIN_DIR@
-asound_module_datadir = @ALSA_DATA_DIR@/alsa.conf.d
+asound_module_gconfdir = @ALSA_GCONF_DIR@
+asound_module_lconfdir = @ALSA_LCONF_DIR@
 
 AM_CFLAGS = -Wall -g @ALSA_CFLAGS@ $(PTHREAD_CFLAGS) $(pulseaudio_CFLAGS) -D_GNU_SOURCE
 AM_LDFLAGS = -module -avoid-version -export-dynamic -no-undefined $(LDFLAGS_NOUNDEFINED)
@@ -21,3 +26,9 @@ libasound_module_ctl_pulse_la_LIBADD = @ALSA_LIBS@ $(PTHREAD_LIBS) $(pulseaudio_
 
 libasound_module_conf_pulse_la_SOURCES = conf_pulse.c
 libasound_module_conf_pulse_la_LIBADD = @ALSA_LIBS@ $(PTHREAD_LIBS) $(pulseaudio_LIBS)
+
+include ../install-hooks.am
+
+install-data-hook: install-conf-hook
+
+uninstall-local: uninstall-conf-hook
diff --git a/rate-lav/10-rate-lav.conf b/rate-lav/10-rate-lav.conf
new file mode 100644
index 0000000..48ede62
--- /dev/null
+++ b/rate-lav/10-rate-lav.conf
@@ -0,0 +1,28 @@
+pcm.lavrate {
+	@args [ SLAVE RATE CONVERTER ]
+	@args.SLAVE {
+		type string
+		default "plug:hw"
+	}
+	@args.RATE {
+		type integer
+		default 48000
+	}
+	@args.CONVERTER {
+		type string
+		default "lavrate"
+	}
+	type rate
+	converter $CONVERTER
+	slave {
+		pcm $SLAVE
+		rate $RATE
+	}
+	hint {
+		show {
+			@func refer
+			name defaults.namehint.basic
+		}
+                description "Rate Converter Plugin Using Libav/FFmpeg Library"
+	}
+}
diff --git a/rate-lav/Makefile.am b/rate-lav/Makefile.am
new file mode 100644
index 0000000..eb672b5
--- /dev/null
+++ b/rate-lav/Makefile.am
@@ -0,0 +1,32 @@
+GCONF_FILES = 10-rate-lav.conf
+
+EXTRA_DIST = $(GCONF_FILES)
+
+asound_module_rate_lavrate_LTLIBRARIES = libasound_module_rate_lavrate.la
+asound_module_gconf_DATA = $(GCONF_FILES)
+
+asound_module_rate_lavratedir = @ALSA_PLUGIN_DIR@
+asound_module_gconfdir = @ALSA_GCONF_DIR@
+
+AM_CFLAGS = -Wall -g @ALSA_CFLAGS@ @LIBAV_CFLAGS@
+AM_LDFLAGS = -module -avoid-version -export-dynamic -no-undefined $(LDFLAGS_NOUNDEFINED)
+
+libasound_module_rate_lavrate_la_SOURCES = rate_lavrate.c
+libasound_module_rate_lavrate_la_LIBADD = @ALSA_LIBS@ @LIBAV_LIBS@ @LIBAV_RESAMPLE_LIBS@
+
+noinst_HEADERS = gcd.h
+
+include ../install-hooks.am
+
+install-exec-hook:
+	rm -f $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_lavrate_*.so
+	$(LN_S) libasound_module_rate_lavrate.so $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_lavrate_higher.so
+	$(LN_S) libasound_module_rate_lavrate.so $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_lavrate_high.so
+	$(LN_S) libasound_module_rate_lavrate.so $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_lavrate_fast.so
+	$(LN_S) libasound_module_rate_lavrate.so $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_lavrate_faster.so
+
+uninstall-hook:
+	rm -f $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_lavrate_*.so
+install-data-hook: install-conf-hook
+
+uninstall-local: uninstall-conf-hook
diff --git a/rate-lavc/gcd.h b/rate-lav/gcd.h
similarity index 100%
rename from rate-lavc/gcd.h
rename to rate-lav/gcd.h
diff --git a/rate-lav/rate_lavrate.c b/rate-lav/rate_lavrate.c
new file mode 100644
index 0000000..2b992c5
--- /dev/null
+++ b/rate-lav/rate_lavrate.c
@@ -0,0 +1,235 @@
+/*
+ * Rate converter plugin using libavresample
+ * Copyright (c) 2014 by Anton Khirnov
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ */
+
+#include <stdio.h>
+#include <alsa/asoundlib.h>
+#include <alsa/pcm_rate.h>
+
+#include <libavresample/avresample.h>
+#include <libavutil/channel_layout.h>
+#include <libavutil/opt.h>
+#include <libavutil/mathematics.h>
+#include <libavutil/samplefmt.h>
+
+
+static unsigned int filter_size = 16;
+static unsigned int phase_shift = 10; /* auto-adjusts */
+static double cutoff = 0; /* auto-adjusts */
+
+struct rate_src {
+	AVAudioResampleContext *avr;
+
+	unsigned int in_rate;
+	unsigned int out_rate;
+	unsigned int channels;
+};
+
+static snd_pcm_uframes_t input_frames(void *obj ATTRIBUTE_UNUSED,
+				      snd_pcm_uframes_t frames)
+{
+	return frames;
+}
+
+static snd_pcm_uframes_t output_frames(void *obj ATTRIBUTE_UNUSED,
+				       snd_pcm_uframes_t frames)
+{
+	return frames;
+}
+
+static void pcm_src_free(void *obj)
+{
+	struct rate_src *rate = obj;
+	avresample_free(&rate->avr);
+}
+
+static int pcm_src_init(void *obj, snd_pcm_rate_info_t *info)
+{
+	struct rate_src *rate = obj;
+	int i, ir, or;
+
+	if (!rate->avr || rate->channels != info->channels) {
+		int ret;
+
+		pcm_src_free(rate);
+		rate->channels = info->channels;
+		ir = rate->in_rate = info->in.rate;
+		or = rate->out_rate = info->out.rate;
+		i = av_gcd(or, ir);
+		if (or > ir) {
+			phase_shift = or/i;
+		} else {
+			phase_shift = ir/i;
+		}
+		if (cutoff <= 0.0) {
+			cutoff = 1.0 - 1.0/filter_size;
+			if (cutoff < 0.80)
+				cutoff = 0.80;
+		}
+
+		rate->avr = avresample_alloc_context();
+		if (!rate->avr)
+			return -ENOMEM;
+
+		av_opt_set_int(rate->avr, "in_sample_rate",     info->in.rate,  0);
+		av_opt_set_int(rate->avr, "out_sample_rate",    info->out.rate, 0);
+		av_opt_set_int(rate->avr, "in_sample_format",   AV_SAMPLE_FMT_S16, 0);
+		av_opt_set_int(rate->avr, "out_sample_format",  AV_SAMPLE_FMT_S16, 0);
+		av_opt_set_int(rate->avr, "in_channel_layout",  av_get_default_channel_layout(rate->channels), 0);
+		av_opt_set_int(rate->avr, "out_channel_layout", av_get_default_channel_layout(rate->channels), 0);
+
+		av_opt_set_int(rate->avr, "filter_size",        filter_size, 0);
+		av_opt_set_int(rate->avr, "phase_shift",        phase_shift, 0);
+		av_opt_set_double(rate->avr, "cutoff",          cutoff,      0);
+
+		ret = avresample_open(rate->avr);
+		if (ret < 0) {
+			avresample_free(&rate->avr);
+			return -EINVAL;
+		}
+	}
+
+	return 0;
+}
+
+static int pcm_src_adjust_pitch(void *obj, snd_pcm_rate_info_t *info)
+{
+	struct rate_src *rate = obj;
+
+	if (info->out.rate != rate->out_rate || info->in.rate != rate->in_rate)
+		pcm_src_init(obj, info);
+	return 0;
+}
+
+static void pcm_src_reset(void *obj)
+{
+	struct rate_src *rate = obj;
+
+	if (rate->avr) {
+#if 0
+		avresample_close(rate->avr);
+		avresample_open(rate->avr);
+#endif
+	}
+}
+
+static void pcm_src_convert_s16(void *obj, int16_t *dst,
+				unsigned int dst_frames,
+				const int16_t *src,
+				unsigned int src_frames)
+{
+	struct rate_src *rate = obj;
+	int chans = rate->channels;
+	unsigned int total_in = avresample_get_delay(rate->avr) + src_frames;
+
+	avresample_convert(rate->avr, (uint8_t **)&dst, dst_frames * chans * 2, dst_frames,
+	                   (uint8_t **)&src, src_frames * chans * 2, src_frames);
+
+	avresample_set_compensation(rate->avr,
+                                    total_in - src_frames > filter_size ? 0 : 1, src_frames);
+}
+
+static void pcm_src_close(void *obj)
+{
+	pcm_src_free(obj);
+}
+
+#if SND_PCM_RATE_PLUGIN_VERSION >= 0x010002
+static int get_supported_rates(void *obj ATTRIBUTE_UNUSED,
+			       unsigned int *rate_min,
+			       unsigned int *rate_max)
+{
+	*rate_min = *rate_max = 0; /* both unlimited */
+	return 0;
+}
+
+static void dump(void *obj ATTRIBUTE_UNUSED, snd_output_t *out)
+{
+	snd_output_printf(out, "Converter: libavr\n");
+}
+#endif
+
+static snd_pcm_rate_ops_t pcm_src_ops = {
+	.close = pcm_src_close,
+	.init = pcm_src_init,
+	.free = pcm_src_free,
+	.reset = pcm_src_reset,
+	.adjust_pitch = pcm_src_adjust_pitch,
+	.convert_s16 = pcm_src_convert_s16,
+	.input_frames = input_frames,
+	.output_frames = output_frames,
+#if SND_PCM_RATE_PLUGIN_VERSION >= 0x010002
+	.version = SND_PCM_RATE_PLUGIN_VERSION,
+	.get_supported_rates = get_supported_rates,
+	.dump = dump,
+#endif
+};
+
+int pcm_src_open(unsigned int version, void **objp, snd_pcm_rate_ops_t *ops)
+
+{
+	struct rate_src *rate;
+
+#if SND_PCM_RATE_PLUGIN_VERSION < 0x010002
+	if (version != SND_PCM_RATE_PLUGIN_VERSION) {
+		fprintf(stderr, "Invalid rate plugin version %x\n", version);
+		return -EINVAL;
+	}
+#endif
+	rate = calloc(1, sizeof(*rate));
+	if (!rate)
+		return -ENOMEM;
+
+	*objp = rate;
+	rate->avr = NULL;
+#if SND_PCM_RATE_PLUGIN_VERSION >= 0x010002
+	if (version == 0x010001)
+		memcpy(ops, &pcm_src_ops, sizeof(snd_pcm_rate_old_ops_t));
+	else
+#endif
+		*ops = pcm_src_ops;
+	return 0;
+}
+
+int SND_PCM_RATE_PLUGIN_ENTRY(lavrate)(unsigned int version, void **objp,
+			snd_pcm_rate_ops_t *ops)
+{
+	return pcm_src_open(version, objp, ops);
+}
+int SND_PCM_RATE_PLUGIN_ENTRY(lavrate_higher)(unsigned int version,
+			void **objp, snd_pcm_rate_ops_t *ops)
+{
+	filter_size = 64;
+	return pcm_src_open(version, objp, ops);
+}
+int SND_PCM_RATE_PLUGIN_ENTRY(lavrate_high)(unsigned int version,
+			void **objp, snd_pcm_rate_ops_t *ops)
+{
+	filter_size = 32;
+	return pcm_src_open(version, objp, ops);
+}
+int SND_PCM_RATE_PLUGIN_ENTRY(lavrate_fast)(unsigned int version,
+			void **objp, snd_pcm_rate_ops_t *ops)
+{
+	filter_size = 8;
+	return pcm_src_open(version, objp, ops);
+}
+int SND_PCM_RATE_PLUGIN_ENTRY(lavrate_faster)(unsigned int version,
+			void **objp, snd_pcm_rate_ops_t *ops)
+{
+	filter_size = 4;
+	return pcm_src_open(version, objp, ops);
+}
+
+
diff --git a/rate-lavc/Makefile.am b/rate-lavc/Makefile.am
deleted file mode 100644
index 5cffd44..0000000
--- a/rate-lavc/Makefile.am
+++ /dev/null
@@ -1,22 +0,0 @@
-asound_module_rate_lavcrate_LTLIBRARIES = libasound_module_rate_lavcrate.la
-
-asound_module_rate_lavcratedir = @ALSA_PLUGIN_DIR@
-
-AM_CFLAGS = -Wall -g @ALSA_CFLAGS@ @AVCODEC_CFLAGS@ \
-	-DAVCODEC_HEADER="@AVCODEC_HEADER@"
-AM_LDFLAGS = -module -avoid-version -export-dynamic -no-undefined $(LDFLAGS_NOUNDEFINED)
-
-libasound_module_rate_lavcrate_la_SOURCES = rate_lavcrate.c
-libasound_module_rate_lavcrate_la_LIBADD = @ALSA_LIBS@ @AVCODEC_LIBS@
-
-noinst_HEADERS = gcd.h
-
-install-exec-hook:
-	rm -f $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_lavcrate_*.so
-	$(LN_S) libasound_module_rate_lavcrate.so $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_lavcrate_higher.so
-	$(LN_S) libasound_module_rate_lavcrate.so $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_lavcrate_high.so
-	$(LN_S) libasound_module_rate_lavcrate.so $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_lavcrate_fast.so
-	$(LN_S) libasound_module_rate_lavcrate.so $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_lavcrate_faster.so
-
-uninstall-hook:
-	rm -f $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_lavcrate_*.so
diff --git a/rate-lavc/rate_lavcrate.c b/rate-lavc/rate_lavcrate.c
deleted file mode 100644
index 14a2198..0000000
--- a/rate-lavc/rate_lavcrate.c
+++ /dev/null
@@ -1,291 +0,0 @@
-/*
- * Rate converter plugin using libavcodec's resampler
- * Copyright (c) 2007 by Nicholas Kain <njkain@gmail.com>
- *
- * based on rate converter that uses libsamplerate
- * Copyright (c) 2006 by Takashi Iwai <tiwai@suse.de>
- *
- * This library is free software; you can redistribute it and/or
- * modify it under the terms of the GNU Lesser General Public
- * License as published by the Free Software Foundation; either
- * version 2.1 of the License, or (at your option) any later version.
- *
- * This library is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- * Lesser General Public License for more details.
- */
-
-#include <stdio.h>
-#include <alsa/asoundlib.h>
-#include <alsa/pcm_rate.h>
-#include AVCODEC_HEADER
-#include "gcd.h"
-
-static int filter_size = 16;
-static int phase_shift = 10; /* auto-adjusts */
-static double cutoff = 0; /* auto-adjusts */
-
-struct rate_src {
-	struct AVResampleContext *context;
-	int in_rate;
-	int out_rate;
-	int stored;
-	int point;
-	int16_t **out;
-	int16_t **in;
-	unsigned int channels;
-};
-
-static snd_pcm_uframes_t input_frames(void *obj, snd_pcm_uframes_t frames)
-{
-	return frames;
-}
-
-static snd_pcm_uframes_t output_frames(void *obj, snd_pcm_uframes_t frames)
-{
-	return frames;
-}
-
-static void pcm_src_free(void *obj)
-{
-	struct rate_src *rate = obj;
-	int i;
-
-	if (rate->out) {
-		for (i=0; i<rate->channels; i++) {
-			free(rate->out[i]);
-		}
-		free(rate->out);
-	}
-	if (rate->in) {
-		for (i=0; i<rate->channels; i++) {
-			free(rate->in[i]);
-		}
-		free(rate->in);
-	}
-	rate->out = rate->in = NULL;
-
-	if (rate->context) {
-		av_resample_close(rate->context);
-		rate->context = NULL;
-	}
-}
-
-static int pcm_src_init(void *obj, snd_pcm_rate_info_t *info)
-{
-	struct rate_src *rate = obj;
-	int i, ir, or;
-
-	if (! rate->context || rate->channels != info->channels) {
-		pcm_src_free(rate);
-		rate->channels = info->channels;
-		ir = rate->in_rate = info->in.rate;
-		or = rate->out_rate = info->out.rate;
-		i = gcd(or, ir);
-		if (or > ir) {
-			phase_shift = or/i;
-		} else {
-			phase_shift = ir/i;
-		}
-		if (cutoff <= 0.0) {
-			cutoff = 1.0 - 1.0/filter_size;
-			if (cutoff < 0.80)
-				cutoff = 0.80;
-		}
-		rate->context = av_resample_init(info->out.rate, info->in.rate,
-			filter_size, phase_shift,
-			(info->out.rate >= info->in.rate ? 0 : 1), cutoff);
-		if (!rate->context)
-			return -EINVAL;
-	}
-
-	rate->out = malloc(rate->channels * sizeof(int16_t *));
-	rate->in = malloc(rate->channels * sizeof(int16_t *));
-	for (i=0; i<rate->channels; i++) {
-		rate->out[i] = calloc(info->out.period_size * 2, 
-			sizeof(int16_t));
-		rate->in[i] = calloc(info->in.period_size * 2,
-			sizeof(int16_t));
-	}
-	rate->point = info->in.period_size / 2;
-	if (!rate->out || !rate->in) {
-		pcm_src_free(rate);
-		return -ENOMEM;
-	}
-
-	return 0;
-}
-
-static int pcm_src_adjust_pitch(void *obj, snd_pcm_rate_info_t *info)
-{
-	struct rate_src *rate = obj;
-
-	if (info->out.rate != rate->out_rate || info->in.rate != rate->in_rate)
-		pcm_src_init(obj, info);
-	return 0;
-}
-
-static void pcm_src_reset(void *obj)
-{
-	struct rate_src *rate = obj;
-	rate->stored = 0;
-}
-
-static void deinterleave(const int16_t *src, int16_t **dst, unsigned int frames,
-	unsigned int chans, int overflow)
-{
-	int i, j;
-
-	if (chans == 1) {
-		memcpy(dst + overflow, src, frames*sizeof(int16_t));
-	} else if (chans == 2) {
-		for (j=overflow; j<(frames + overflow); j++) {
-			dst[0][j] = *(src++);
-			dst[1][j] = *(src++);
-		}
-	} else {
-		for (j=overflow; j<(frames + overflow); j++) {
-			for (i=0; i<chans; i++) {
-				dst[i][j] = *(src++);
-			}
-		}
-	}
-}
-
-static void reinterleave(int16_t **src, int16_t *dst, unsigned int frames,
-	unsigned int chans)
-{
-	int i, j;
-
-	if (chans == 1) {
-		memcpy(dst, src, frames*sizeof(int16_t));
-	} else if (chans == 2) {
-		for (j=0; j<frames; j++) {
-			*(dst++) = src[0][j];
-			*(dst++) = src[1][j];
-		}
-	} else {
-		for (j=0; j<frames; j++) {
-			for (i=0; i<chans; i++) {
-				*(dst++) = src[i][j];
-			}
-		}
-	}
-}
-
-static void pcm_src_convert_s16(void *obj, int16_t *dst, unsigned int
-	dst_frames, const int16_t *src, unsigned int src_frames)
-{
-	struct rate_src *rate = obj;
-	int consumed = 0, chans=rate->channels, ret=0, i;
-	int total_in = rate->stored + src_frames, new_stored;
-
-	deinterleave(src, rate->in, src_frames, chans, rate->point);
-	for (i=0; i<chans; ++i) {	
-		ret = av_resample(rate->context, rate->out[i],
-				rate->in[i]+rate->point-rate->stored, &consumed,
-				total_in, dst_frames, i == (chans - 1));
-		new_stored = total_in-consumed;
-		memmove(rate->in[i]+rate->point-new_stored,
-				rate->in[i]+rate->point-rate->stored+consumed,
-				new_stored*sizeof(int16_t));
-	}
-	av_resample_compensate(rate->context,
-			total_in-src_frames>filter_size?0:1, src_frames);
-	reinterleave(rate->out, dst, ret, chans);
-	rate->stored = total_in-consumed;
-}
-
-static void pcm_src_close(void *obj)
-{
-	pcm_src_free(obj);
-}
-
-#if SND_PCM_RATE_PLUGIN_VERSION >= 0x010002
-static int get_supported_rates(void *obj, unsigned int *rate_min,
-			       unsigned int *rate_max)
-{
-	*rate_min = *rate_max = 0; /* both unlimited */
-	return 0;
-}
-
-static void dump(void *obj, snd_output_t *out)
-{
-	snd_output_printf(out, "Converter: liblavc\n");
-}
-#endif
-
-static snd_pcm_rate_ops_t pcm_src_ops = {
-	.close = pcm_src_close,
-	.init = pcm_src_init,
-	.free = pcm_src_free,
-	.reset = pcm_src_reset,
-	.adjust_pitch = pcm_src_adjust_pitch,
-	.convert_s16 = pcm_src_convert_s16,
-	.input_frames = input_frames,
-	.output_frames = output_frames,
-#if SND_PCM_RATE_PLUGIN_VERSION >= 0x010002
-	.version = SND_PCM_RATE_PLUGIN_VERSION,
-	.get_supported_rates = get_supported_rates,
-	.dump = dump,
-#endif
-};
-
-int pcm_src_open(unsigned int version, void **objp, snd_pcm_rate_ops_t *ops)
-
-{
-	struct rate_src *rate;
-
-#if SND_PCM_RATE_PLUGIN_VERSION < 0x010002
-	if (version != SND_PCM_RATE_PLUGIN_VERSION) {
-		fprintf(stderr, "Invalid rate plugin version %x\n", version);
-		return -EINVAL;
-	}
-#endif
-	rate = calloc(1, sizeof(*rate));
-	if (!rate)
-		return -ENOMEM;
-
-	*objp = rate;
-	rate->context = NULL;
-#if SND_PCM_RATE_PLUGIN_VERSION >= 0x010002
-	if (version == 0x010001)
-		memcpy(ops, &pcm_src_ops, sizeof(snd_pcm_rate_old_ops_t));
-	else
-#endif
-		*ops = pcm_src_ops;
-	return 0;
-}
-
-int SND_PCM_RATE_PLUGIN_ENTRY(lavcrate)(unsigned int version, void **objp,
-			snd_pcm_rate_ops_t *ops)
-{
-	return pcm_src_open(version, objp, ops);
-}
-int SND_PCM_RATE_PLUGIN_ENTRY(lavcrate_higher)(unsigned int version,
-			void **objp, snd_pcm_rate_ops_t *ops)
-{
-	filter_size = 64;
-	return pcm_src_open(version, objp, ops);
-}
-int SND_PCM_RATE_PLUGIN_ENTRY(lavcrate_high)(unsigned int version,
-			void **objp, snd_pcm_rate_ops_t *ops)
-{
-	filter_size = 32;
-	return pcm_src_open(version, objp, ops);
-}
-int SND_PCM_RATE_PLUGIN_ENTRY(lavcrate_fast)(unsigned int version,
-			void **objp, snd_pcm_rate_ops_t *ops)
-{
-	filter_size = 8;
-	return pcm_src_open(version, objp, ops);
-}
-int SND_PCM_RATE_PLUGIN_ENTRY(lavcrate_faster)(unsigned int version,
-			void **objp, snd_pcm_rate_ops_t *ops)
-{
-	filter_size = 4;
-	return pcm_src_open(version, objp, ops);
-}
-
-
diff --git a/rate/10-samplerate.conf b/rate/10-samplerate.conf
new file mode 100644
index 0000000..0d2e604
--- /dev/null
+++ b/rate/10-samplerate.conf
@@ -0,0 +1,28 @@
+pcm.samplerate {
+	@args [ SLAVE RATE CONVERTER ]
+	@args.SLAVE {
+		type string
+		default "plug:hw"
+	}
+	@args.RATE {
+		type integer
+		default 48000
+	}
+	@args.CONVERTER {
+		type string
+		default "samplerate"
+	}
+	type rate
+	converter $CONVERTER
+	slave {
+		pcm $SLAVE
+		rate $RATE
+	}
+	hint {
+		show {
+			@func refer
+			name defaults.namehint.basic
+		}
+                description "Rate Converter Plugin Using Samplerate Library"
+	}
+}
diff --git a/rate/Makefile.am b/rate/Makefile.am
index 0605bfd..488c12a 100644
--- a/rate/Makefile.am
+++ b/rate/Makefile.am
@@ -1,6 +1,12 @@
+GCONF_FILES = 10-samplerate.conf
+
+EXTRA_DIST = $(GCONF_FILES)
+
 asound_module_rate_samplerate_LTLIBRARIES = libasound_module_rate_samplerate.la
+asound_module_gconf_DATA = $(GCONF_FILES)
 
 asound_module_rate_sampleratedir = @ALSA_PLUGIN_DIR@
+asound_module_gconfdir = @ALSA_GCONF_DIR@
 
 AM_CFLAGS = -Wall -g @ALSA_CFLAGS@ $(samplerate_CFLAGS)
 AM_LDFLAGS = -module -avoid-version -export-dynamic -no-undefined $(LDFLAGS_NOUNDEFINED)
@@ -8,6 +14,8 @@ AM_LDFLAGS = -module -avoid-version -export-dynamic -no-undefined $(LDFLAGS_NOUN
 libasound_module_rate_samplerate_la_SOURCES = rate_samplerate.c
 libasound_module_rate_samplerate_la_LIBADD = @ALSA_LIBS@ @samplerate_LIBS@
 
+include ../install-hooks.am
+
 install-exec-hook:
 	rm -f $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_samplerate_*.so
 	$(LN_S) libasound_module_rate_samplerate.so $(DESTDIR)@ALSA_PLUGIN_DIR@/libasound_module_rate_samplerate_best.so
@@ -17,3 +25,7 @@ install-exec-hook:
 
 uninstall-hook:
 	rm -f $(DESTDIR)$(libdir)/alsa-lib/libasound_module_rate_samplerate_*.so
+
+install-data-hook: install-conf-hook
+
+uninstall-local: uninstall-conf-hook
diff --git a/rate/rate_samplerate.c b/rate/rate_samplerate.c
index 0b14a59..100d6f2 100644
--- a/rate/rate_samplerate.c
+++ b/rate/rate_samplerate.c
@@ -154,14 +154,14 @@ static void pcm_src_close(void *obj)
 }
 
 #if SND_PCM_RATE_PLUGIN_VERSION >= 0x010002
-static int get_supported_rates(void *obj, unsigned int *rate_min,
+static int get_supported_rates(void *obj ATTRIBUTE_UNUSED, unsigned int *rate_min,
 			       unsigned int *rate_max)
 {
 	*rate_min = *rate_max = 0; /* both unlimited */
 	return 0;
 }
 
-static void dump(void *obj, snd_output_t *out)
+static void dump(void *obj ATTRIBUTE_UNUSED, snd_output_t *out)
 {
 	snd_output_printf(out, "Converter: libsamplerate\n");
 }
diff --git a/speex/60-speex.conf b/speex/60-speex.conf
new file mode 100644
index 0000000..bf2ce95
--- /dev/null
+++ b/speex/60-speex.conf
@@ -0,0 +1,63 @@
+pcm.speex {
+	@args [ SLAVE AGC AGC_LEVEL DENOISE ECHO
+                DEREVERB DEREVERB_DECAY DEREVERB_LEVEL
+                FRAMES FILTER_LENGTH ]
+	@args.SLAVE {
+		type string
+		default "plug:hw"
+	}
+	@args.AGC {
+		type string
+		default off
+	}
+	@args.AGC_LEVEL {
+		type integer
+		default 8000
+	}
+	@args.DENOISE {
+		type string
+		default on
+	}
+	@args.ECHO {
+		type string
+		default off
+	}
+	@args.DEREVERB {
+		type string
+		default off
+	}
+	@args.DEREVERB_DECAY {
+		type real
+		default 0
+	}
+	@args.DEREVERB_LEVEL {
+		type real
+		default 0
+	}
+	@args.FRAMES {
+		type integer
+		default 64
+	}
+	@args.FILTER_LENGTH {
+		type integer
+		default 256
+	}
+	type speex
+	agc $AGC
+	agc_level $AGC_LEVEL
+	denoise $DENOISE
+	echo $ECHO
+	dereverb $DEREVERB
+	dereverb_decay $DEREVERB_DECAY
+	dereverb_level $DEREVERB_LEVEL
+	frames $FRAMES
+	filter_length $FILTER_LENGTH
+	slave.pcm $SLAVE
+	hint {
+		show {
+			@func refer
+			name defaults.namehint.basic
+		}
+                description "Plugin using Speex DSP (resample, agc, denoise, echo, dereverb)"
+	}
+}
diff --git a/speex/Makefile.am b/speex/Makefile.am
index 7d84190..27c4ea5 100644
--- a/speex/Makefile.am
+++ b/speex/Makefile.am
@@ -1,9 +1,21 @@
+GCONF_FILES = 60-speex.conf
+
+EXTRA_DIST = $(GCONF_FILES)
+
 asound_module_pcm_speex_LTLIBRARIES = libasound_module_pcm_speex.la
+asound_module_gconf_DATA = $(GCONF_FILES)
 
 asound_module_pcm_speexdir = @ALSA_PLUGIN_DIR@
+asound_module_gconfdir = @ALSA_GCONF_DIR@
 
 AM_CFLAGS = -Wall -g @ALSA_CFLAGS@ @speexdsp_CFLAGS@
 AM_LDFLAGS = -module -avoid-version -export-dynamic -no-undefined $(LDFLAGS_NOUNDEFINED)
 
 libasound_module_pcm_speex_la_SOURCES = pcm_speex.c
 libasound_module_pcm_speex_la_LIBADD = @ALSA_LIBS@ @speexdsp_LIBS@
+
+include ../install-hooks.am
+
+install-data-hook: install-conf-hook
+
+uninstall-local: uninstall-conf-hook
diff --git a/usb_stream/98-usb-stream.conf b/usb_stream/98-usb-stream.conf
new file mode 100644
index 0000000..2efc95f
--- /dev/null
+++ b/usb_stream/98-usb-stream.conf
@@ -0,0 +1,27 @@
+pcm.usbstream {
+	@args [ CARD RATE PERIOD_SIZE ]
+	@args.CARD {
+		type string
+		default {
+			func refer
+			name defaults.pcm.card
+		}
+	}
+	@args.RATE {
+		type integer
+	}
+	@args.PERIOD_SIZE {
+		type integer
+	}
+	type usb_stream
+	card $CARD
+	rate $RATE
+	period_size $PERIOD_SIZE
+	hint {
+		show {
+			@func refer
+			name defaults.namehint.basic
+		}
+                description "USB Stream Output"
+	}
+}
diff --git a/usb_stream/Makefile.am b/usb_stream/Makefile.am
index 50a98a0..fde2455 100644
--- a/usb_stream/Makefile.am
+++ b/usb_stream/Makefile.am
@@ -1,11 +1,23 @@
+GCONF_FILES = 98-usb-stream.conf
+
+EXTRA_DIST = $(GCONF_FILES)
+
 asound_module_pcm_usb_stream_LTLIBRARIES = libasound_module_pcm_usb_stream.la
+asound_module_gconf_DATA = $(GCONF_FILES)
 
 asound_module_pcm_usb_streamdir = @ALSA_PLUGIN_DIR@
+asound_module_gconfdir = @ALSA_GCONF_DIR@
 
 AM_CFLAGS = -Wall -g @ALSA_CFLAGS@
 AM_LDFLAGS = -module -avoid-version -export-dynamic $(LDFLAGS_NOUNDEFINED)
 
 libasound_module_pcm_usb_stream_la_SOURCES = pcm_usb_stream.c
-libasound_module_pcm_usb_stream_la_LIBADD = @ALSA_LIBS@
+libasound_module_pcm_usb_stream_la_LIBADD = @ALSA_LIBS@ -lpthread
 
 noinst_HEADERS = usb_stream.h
+
+include ../install-hooks.am
+
+install-data-hook: install-conf-hook
+
+uninstall-local: uninstall-conf-hook

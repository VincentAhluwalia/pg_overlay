From 79f2f6d41ad877965d77252f51015623290f8c9d Mon Sep 17 00:00:00 2001
From: Tilmann Meyer <me@atiltedtree.dev>
Date: Fri, 19 Nov 2021 12:31:16 +0100
Subject: [PATCH 15/18] If only wayland is enabled, always use it regardless of
 MOZ_ENABLE_WAYLAND

---
 toolkit/xre/nsAppRunner.cpp | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/toolkit/xre/nsAppRunner.cpp b/toolkit/xre/nsAppRunner.cpp
index d99749305db29..564b335a1ed59 100644
--- a/toolkit/xre/nsAppRunner.cpp
+++ b/toolkit/xre/nsAppRunner.cpp
@@ -4493,6 +4493,7 @@ static void PR_CALLBACK ReadAheadDlls_ThreadStart(void* arg) {
 
 #if defined(MOZ_WAYLAND)
 bool IsWaylandEnabled() {
+#  ifdef MOZ_X11
   const char* waylandDisplay = PR_GetEnv("WAYLAND_DISPLAY");
   if (!waylandDisplay) {
     return false;
@@ -4513,7 +4514,7 @@ bool IsWaylandEnabled() {
       return true;
     }
   }
-#  ifdef EARLY_BETA_OR_EARLIER
+#   ifdef EARLY_BETA_OR_EARLIER
   // Enable by default when we're running on a recent enough GTK version. We'd
   // like to check further details like compositor version and so on ideally
   // to make sure we don't enable it on old Mutter or what not, but we can't,
@@ -4525,8 +4526,11 @@ bool IsWaylandEnabled() {
   // GNOME / KDE  / known-good-desktop environments by checking
   // XDG_CURRENT_DESKTOP or so...
   return !gtk_check_version(3, 24, 30);
-#  else
+#   else
   return false;
+#   endif
+#  else
+  return true;
 #  endif
 }
 #endif
-- 
2.35.1

